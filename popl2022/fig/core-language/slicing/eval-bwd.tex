\begin{figure}[H]
\flushleft \shadebox{$\evalBwd{v}{T}{\rho}{e}{\alpha}$}
\begin{smathpar}
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-eq}}
   ]
   {
      v \eq v'
      \\
      \evalBwd{v'}{T}{\rho}{e}{\alpha}
   }
   {
      \evalBwd{v}{T}{\rho}{e}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-var}},
      right={$\envLookupBwd{\rho'}{\rho}{\bind{x}{v}}$}
   ]
   {
      \strut
   }
   {
      \evalBwd{v}{\trVar{x}{\rho}}{\rho'}{\exVar{x}}{\FF}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-lambda}}
   ]
   {
      \strut
   }
   {
      \evalBwd{\exClosure{\rho}{\seqEmpty}{\sigma}}
              {\trLambda{\sigma'}}
              {\rho}
              {\exLambda{\sigma}}
              {\FF}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-int}}
   ]
   {
      \strut
   }
   {
      \evalBwd{\annInt{n}{\alpha}}
              {\trInt{n}{\rho}}
              {\hole_{\rho}}
              {\annInt{n}{\alpha}}
              {\alpha}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalBwdS$-record}}]
   {
      \evalBwd{v_i}{T_i}{\rho_i}{e_i}{\alpha_i'}
      \quad
      (\forall i \numleq \length{\vec{x}})
   }
   {
      \evalBwd{\annRec{\vec{\bind{x}{v}}}{\alpha}}
              {\trRec{\vec{\bind{x}{T}}}}
              {\bigjoin\vec{\rho}}
              {\annRec{\vec{\bind{x}{e}}}{\alpha}}
              {\alpha \join \bigjoin\vec{\alpha}'}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalBwdS$-project}}]
   {
      \evalBwd{\mapUpdate{\exRec{\vec{\bind{x}{\hole}}}}{x_i}{v}}{T}{\rho}{e}{\alpha}
   }
   {
      \evalBwd{v}
              {\trRecProj{T}{x_i}}
              {\rho}
              {\exRecProj{e}{x_i}}
              {\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-nil}}
   ]
   {
      \strut
   }
   {
      \evalBwd{\annNil{\alpha}}
              {\trNil{\rho}}
              {\hole_{\rho}}
              {\annNil{\alpha}}
              {\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-cons}}
   ]
   {
      \evalBwd{v}{T}{\rho}{e}{\alpha}
      \\
      \evalBwd{v'}{U}{\rho'}{e'}{\alpha'}
   }
   {
      \evalBwd{\annCons{v}{v'}{\beta}}
              {\trCons{T}{U}}
              {\rho \join \rho'}
              {\annCons{e}{e'}{\beta}}
              {\beta \join \alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-vector}}
   ]
   {
      \evalBwd{u_{i}}
              {U_{i}}
              {\rho_{i} \concat \bind{x}{i_{\beta'_{i}}}}
              {e_{i}}
              {\alpha'_{i}}
      \quad
      (\forall i \numleq j)
      \\
      \evalBwd{\annInt{j}{\beta \join {\hspace{0.1em}{\oldbigjoin}\hspace{-0.15em}{\vec{\beta}'}}}}
              {T}
              {\rho'}
              {e'}
              {\alpha^\twoPrime}
   }
   {
      \evalBwd{\annVecVal{\vec{u}}{\annInt{j}{\beta}}{\alpha}}
              {\trVec{\vec{U}}{x}{T}{j}}
              {\bigjoin\vec{\rho} \join \rho'}
              {\annVec{\bigjoin\vec{e}}{x}{e'}{\alpha}}
              {\alpha \join {\bigjoin{\vec{\alpha}'}} \join \alpha^\twoPrime}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-vector-lookup}}
   ]
   {
      \evalBwd{\mapUpdate{\annVecVal{\vec{\hole}}{\annInt{j}{\FF}}{\FF}}{i}{v}}
              {T}{\rho}{e_1}{\alpha}
      \\
      \evalBwd{\annInt{i}{\FF}}{U}{\rho'}{e_2}{\alpha'}
   }
   {
      \evalBwd{v}{\trVecLookup{T}{j}{U}{i}}{\rho \join \rho'}{\exVecLookup{e_1}{e_2}}{\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-vector-length}}
   ]
   {
      \evalBwd{\annVecVal{\vec{\hole}}{\annInt{j}{\beta}}{\FF}}{T}{\rho}{e}{\alpha}
   }
   {
      \evalBwd{\annInt{j}{\beta}}{\trVecLen{T}{j}}{\rho}{\exVecLen{e}}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-apply-prim}},
      right={$\primBwd{\phi}{\vec{n} \concat m}(v) = \vec{u} \concat u'$}
   ]
   {
      \evalBwd{\exPrimOp{\phi}{\vec{u}}}{T}{\rho}{e_1}{\alpha}
      \\
      \evalBwd{u'}{U}{\rho'}{e_2}{\alpha'}
   }
   {
      \evalBwd{v}
              {\trAppPrim{T}{\phi}{\vec{n}}{U}{\exInt{m}}}
              {\rho \join \rho'}
              {\exApp{e_1}{e_2}}
              {\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-apply}}
   ]
   {
      \evalBwd{v}{T'}{\rho_1 \concat \rho_2 \concat \rho_3}{e}{\beta}
      \\
      \matchBwd{\rho_3}{e}{\beta}{w}{v'}{\sigma}
      \\
      \evalBwd{v'}{U}{\rho}{e_2}{\alpha}
      \\
      \rho_2 \closeDefsBwdR \rho_1', h
      \\
      \evalBwd{\exClosure{\rho_1 \join \rho_1'}{h}{\sigma}}{T}{\rho'}{e_1}{\alpha'}
   }
   {
      \evalBwd{v}{\trApp{T}{U}{w}{T'}}{\rho \join \rho'}{\exApp{e_1}{e_2}}{\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-let-rec}}
   ]
   {
      \evalBwd{v}{T}{\rho \concat \rho_1}{e}{\alpha}
      \\
      \rho_1 \closeDefsBwdR \rho', h'
   }
   {
      \evalBwd{v}{\trLetRecMutual{h}{T}}{\rho \join \rho'}{\exLetRecMutual{h'}{e}}{\alpha}
   }
\end{smathpar}
\caption{Evaluation: backward dependency (Boolean cases omitted)}
\label{fig:eval:bwd}
\end{figure}
