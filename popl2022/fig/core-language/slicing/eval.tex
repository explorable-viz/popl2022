\begin{figure}
{\small \flushleft \shadebox{$\evalFwd{\rho}{e}{\alpha}{T}{v}$}%
\hfill \textbfit{$\rho$ and $e$, with argument availability $\alpha$, forward-analyse along $T$ to $v$}}
\begin{smathpar}
   \mprset{center}
   \inferrule*[
      lab={\ruleName{$\evalFwdS$-eq}}
   ]
   {
      e \eq e'
      \\
      \evalFwd{\rho}{e'}{\alpha}{T}{v}
   }
   {
      \evalFwd{\rho}{e}{\alpha}{T}{v}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalFwdS$-var}},
      right={$\envLookup{\rho}{x}{v}$}
   ]
   {
      \strut
   }
   {
      \evalFwd{\rho}{\exVar{x}}{\alpha}{\trVar{x}{\rho}}{v}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalFwdS$-lambda}}]
   {
      \strut
   }
   {
      \evalFwd{\rho}
              {\exLambda{\sigma}}
              {\alpha}
              {\trLambda{\sigma'}}
              {\exClosure{\rho}{\seqEmpty}{\sigma}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalFwdS$-int}}]
   {
      \strut
   }
   {
      \evalFwd{\rho}
              {\annInt{n}{\alpha}}
              {\alpha'}
              {\trInt{n}{\rho}}
              {\annInt{n}{\alpha \meet \alpha'}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalR$-record}}]
   {
      \evalFwd{\rho}{e_i}{\alpha'}{T_i}{v_i}
      \quad
      (\forall i \numleq \length{\vec{x}})
   }
   {
      \evalFwd{\rho}
              {\annRec{\vec{\bind{x}{e}}}{\alpha}}
              {\alpha'}
              {\trRec{\vec{\bind{x}{T}}}}
              {\annRec{\vec{\bind{x}{v}}}{\alpha \meet \alpha'}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalR$-project}},
      right={$i \numleq \length{\vec{x}}$}
   ]
   {
      \evalFwd{\rho}{e}{\alpha}{T}{\exRec{\vec{\bind{x}{v}}}}
   }
   {
      \evalFwd{\rho}
              {\exRecProj{e}{x}}
              {\alpha}
              {\trRecProj{T}{\vec{x}}{x}}
              {v_i}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalFwdS$-nil}}]
   {
      \strut
   }
   {
      \evalFwd{\rho}
              {\annNil{\alpha}}
              {\alpha'}
              {\trNil{\rho}}
              {\annNil{\alpha \meet \alpha'}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalFwdS$-cons}},
   ]
   {
      \evalFwd{\rho}{e}{\alpha'}{T}{v}
      \\
      \evalFwd{\rho}{e'}{\alpha'}{U}{v'}
   }
   {
      \evalFwd{\rho}
              {\annCons{e}{e'}{\alpha}}
              {\alpha'}
              {\trCons{T}{U}}
              {\annCons{v}{v'}{\alpha \meet \alpha'}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalFwdS$-apply-prim}}
   ]
   {
      \evalFwdEq{\rho}{e}{\alpha}{T}{\exPrimOp{\phi}{\vec{v}}}
      \\
      \evalFwd{\rho}{e'}{\alpha}{U}{u}
   }
   {
      \evalFwd{\rho}
              {\exApp{e}{e'}}
              {\alpha}
              {\trAppPrim{T}{\phi}{\vec{n}}{U}{\exInt{m}}}
              {\primFwd{\phi}{\vec{n} \concat m}(\vec{v} \concat u)}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalFwdS$-apply}},
      width={3in}
   ]
   {
      \evalFwdEq{\rho}{e}{\alpha}{T}{\exClosure{\rho_1}{h}{\sigma}}
      \\
      \rho_1, h \closeDefsR \rho_2
      \\
      \evalFwd{\rho}{e'}{\alpha}{U}{v}
      \\
      \matchFwd{v}{\sigma}{w}{\rho_3}{e^\twoPrime}{\beta}
      \\
      \evalFwd{\rho_1 \concat \rho_2 \concat \rho_3}{e^\twoPrime}{\beta}{T'}{v'}
   }
   {
      \evalFwd{\rho}{\exApp{e}{e'}}{\alpha}{\trApp{T}{U}{w}{T'}}{v'}
   }
   %
   \and
   %
   \inferrule*[lab={
      \ruleName{$\evalFwdS$-let-rec}}
   ]
   {
      \rho, h' \closeDefsR \rho'
      \\
      \evalFwd{\rho \concat \rho'}{e}{\alpha}{T}{v}
   }
   {
      \evalFwd{\rho}{\exLetRecMutual{h'}{e}}{\alpha}{\trLetRecMutual{h}{T}}{v}
   }
\end{smathpar}
\vspace{1mm}

{\small \flushleft \shadebox{$\matchFwd{v}{\sigma}{w}{\rho}{\kappa}{\alpha}$}%
\hfill \textbfit{$v$ and $\sigma$ forward-analyse along $w$ to $\rho$ and $\kappa$, with argument availability $\alpha$}}
\begin{smathpar}
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-eq}}
   ]
   {
      (v,\sigma) \eq (v',\sigma')
      \\
      \matchFwd{v'}{\sigma'}{w}{\rho}{\kappa}{\alpha}
   }
   {
      \matchFwd{v}{\sigma}{w}{\rho}{\kappa}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-var}}
   ]
   {
      \strut
   }
   {
      \matchFwd{v}{\elimVar{x}{\kappa}}{\matchVar{x}}{\bind{x}{v}}{\kappa}{\TT}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-true}}
   ]
   {
      \strut
   }
   {
      \matchFwd{\annTrue{\alpha}}
               {\elimBool{\kappa}{\kappa'}}
               {\matchTrue}
               {\seqEmpty}{\kappa}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-false}}
   ]
   {
      \strut
   }
   {
      \matchFwd{\annFalse{\alpha}}
               {\elimBool{\kappa}{\kappa'}}
               {\matchFalse}
               {\seqEmpty}{\kappa'}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-unit}}
   ]
   {
      \strut
   }
   {
      \matchFwd{\annot{\exRecEmpty}{\alpha}}
               {\elimRecEmpty{\kappa}}
               {\matchRecEmpty}
               {\seqEmpty}
               {\kappa}
               {\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-record}}
   ]
   {
      \matchFwd{\annRec{\vec{\bind{x}{v}}}{\FF}}
               {\elimRec{\vec{x}}{\sigma}}
               {\matchRec{\vec{\bind{x}{w}}}}
               {\rho}
               {\sigma'}
               {\beta}
      \\
      \matchFwd{u}{\sigma'}{w}{\rho'}{\kappa}{\beta'}
   }
   {
      \matchFwd{\annRec{\vec{\bind{x}{v}} \concat \bind{y}{u}}{\alpha}}
               {\elimRec{\vec{x} \concat y}{\sigma}}
               {\matchRec{\vec{\bind{x}{w}} \concat \bind{y}{w'}}}
               {\rho \concat \rho'}
               {\kappa}
               {\alpha \meet \beta \meet \beta'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-nil}}
   ]
   {
      \strut
   }
   {
      \matchFwd{\annNil{\alpha}}
               {\elimList{\kappa}{\sigma'}}
               {\matchNil}
               {\seqEmpty}{\kappa}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\matchFwdS$-cons}}
   ]
   {
      \matchFwd{v}{\sigma}{w}{\rho}{\tau}{\beta}
      \\
      \matchFwd{v'}{\tau}{w'}{\rho'}{\kappa}{\beta'}
   }
   {
      \matchFwd{\annCons{v}{v'}{\alpha}}
               {\elimList{\kappa}{\sigma}}
               {\matchCons{w}{w'}}
               {\rho \concat \rho'}{\kappa}{\alpha \meet \beta \meet \beta'}
   }
\end{smathpar}
\caption{Forward data dependency (Boolean cases for $\evalFwdR{T}$ omitted)}
\label{fig:data-dependencies:fwd}
\end{figure}

\begin{figure}
{\small \flushleft \shadebox{$\evalBwd{v}{T}{\rho}{e}{\alpha}$}%
\hfill \textbfit{$v$ backward-analyses along $T$ to $\rho$ and $e$, with argument demand $\alpha$}}
\begin{smathpar}
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-eq}}
   ]
   {
      v \eq v'
      \\
      \evalBwd{v'}{T}{\rho}{e}{\alpha}
   }
   {
      \evalBwd{v}{T}{\rho}{e}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-var}},
      right={$\envLookupBwd{\rho'}{\rho}{\bind{x}{v}}$}
   ]
   {
      \strut
   }
   {
      \evalBwd{v}{\trVar{x}{\rho}}{\rho'}{\exVar{x}}{\FF}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-lambda}}
   ]
   {
      \strut
   }
   {
      \evalBwd{\exClosure{\rho}{\seqEmpty}{\sigma}}
              {\trLambda{\sigma'}}
              {\rho}
              {\exLambda{\sigma}}
              {\FF}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-int}}
   ]
   {
      \strut
   }
   {
      \evalBwd{\annInt{n}{\alpha}}
              {\trInt{n}{\rho}}
              {\hole_{\rho}}
              {\annInt{n}{\alpha}}
              {\alpha}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalBwdS$-record}}]
   {
      \evalBwd{v_i}{T_i}{\rho_i}{e_i}{\alpha_i'}
      \quad
      (\forall i \numleq \length{\vec{x}})
   }
   {
      \evalBwd{\annRec{\vec{\bind{x}{v}}}{\alpha}}
              {\trRec{\vec{\bind{x}{T}}}}
              {\bigjoin\vec{\rho}}
              {\annRec{\vec{\bind{x}{e}}}{\alpha}}
              {\alpha \join \bigjoin\vec{\alpha}'}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\evalBwdS$-project}}]
   {
      \evalBwd{\annRec{\mapUpdate{\vec{\bind{x}{\hole}}}{x_i}{v}}{\FF}}
              {T}
              {\rho}
              {e}
              {\alpha}
   }
   {
      \evalBwd{v}
              {\trRecProj{T}{\vec{x}}{x_i}}
              {\rho}
              {\exRecProj{e}{x_i}}
              {\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-nil}}
   ]
   {
      \strut
   }
   {
      \evalBwd{\annNil{\alpha}}
              {\trNil{\rho}}
              {\hole_{\rho}}
              {\annNil{\alpha}}
              {\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-cons}}
   ]
   {
      \evalBwd{v}{T}{\rho}{e}{\alpha}
      \\
      \evalBwd{v'}{U}{\rho'}{e'}{\alpha'}
   }
   {
      \evalBwd{\annCons{v}{v'}{\beta}}
              {\trCons{T}{U}}
              {\rho \join \rho'}
              {\annCons{e}{e'}{\beta}}
              {\beta \join \alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-apply-prim}},
      right={$\primBwd{\phi}{\vec{n} \concat m}(v) = \vec{u} \concat u'$}
   ]
   {
      \evalBwd{\exPrimOp{\phi}{\vec{u}}}{T}{\rho}{e_1}{\alpha}
      \\
      \evalBwd{u'}{U}{\rho'}{e_2}{\alpha'}
   }
   {
      \evalBwd{v}
              {\trAppPrim{T}{\phi}{\vec{n}}{U}{\exInt{m}}}
              {\rho \join \rho'}
              {\exApp{e_1}{e_2}}
              {\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-apply}},
      width={3.25in}
   ]
   {
      \evalBwd{v}{T'}{\rho_1 \concat \rho_2 \concat \rho_3}{e}{\beta}
      \\
      \matchBwd{\rho_3}{e}{\beta}{w}{v'}{\sigma}
      \\
      \evalBwd{v'}{U}{\rho}{e_2}{\alpha}
      \\
      \rho_2 \closeDefsBwdR \rho_1', h
      \\
      \evalBwd{\exClosure{\rho_1 \join \rho_1'}{h}{\sigma}}{T}{\rho'}{e_1}{\alpha'}
   }
   {
      \evalBwd{v}{\trApp{T}{U}{w}{T'}}{\rho \join \rho'}{\exApp{e_1}{e_2}}{\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-let-rec}}
   ]
   {
      \evalBwd{v}{T}{\rho \concat \rho_1}{e}{\alpha}
      \\
      \rho_1 \closeDefsBwdR \rho', h'
   }
   {
      \evalBwd{v}{\trLetRecMutual{h}{T}}{\rho \join \rho'}{\exLetRecMutual{h'}{e}}{\alpha}
   }
\end{smathpar}
\vspace{1mm}

{\small \flushleft \shadebox{$\matchBwd{\rho}{\kappa}{\alpha}{w}{v}{\sigma}$}%
\hfill \textbfit{$\rho$ and $\kappa$, with argument demand $\alpha$, backward-analyse along $w$ to $v$ and $\sigma$}}
\begin{smathpar}
   \inferrule*[lab={\ruleName{$\matchBwdS$-var}}]
   {
      \strut
   }
   {
      \matchBwd{\bind{x}{v}}{\kappa}{\alpha}{\matchVar{x}}{v}{\elimVar{x}{\kappa}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\matchBwdS$-unit}}]
   {
      \strut
   }
   {
      \matchBwd{\seqEmpty}
               {\kappa}
               {\alpha}
               {\matchRecEmpty}
               {\annot{\exRecEmpty}{\alpha}}
               {\elimRecEmpty{\kappa}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\matchBwdS$-nil}}]
   {
      \strut
   }
   {
      \matchBwd{\seqEmpty}{\kappa}{\alpha}{\matchNil}{\annNil{\alpha}}{\elimList{\kappa}{\hole}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\matchBwdS$-record}}]
   {
      \matchBwd{\rho'}{\kappa}{\alpha}{w'}{u}{\sigma}
      \\
      \matchBwd{\rho}
               {\sigma}
               {\alpha}
               {\matchRec{\vec{\bind{x}{w}}}}
               {\annRec{\vec{\bind{x}{v}}}{\beta}}
               {\tau}
   }
   {
      \matchBwd{\rho \concat \rho'}
               {\kappa}
               {\alpha}
               {\matchRec{\vec{\bind{x}{w}} \concat \bind{y}{w'}}}
               {\annRec{\vec{\bind{x}{v}} \concat \bind{y}{u}}{\alpha}}
               {\elimRec{\vec{x} \concat y}{\tau}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\matchBwdS$-cons}}]
   {
      \matchBwd{\rho'}{\kappa}{\alpha}{w'}{v'}{\sigma}
      \\
      \matchBwd{\rho}{\sigma}{\alpha}{w}{v}{\tau}
   }
   {
      \matchBwd{\rho \concat \rho'}
               {\kappa}
               {\alpha}
               {\matchCons{w}{w'}}
               {\annCons{v}{v'}{\alpha}}
               {\elimList{\hole}{\tau}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\matchBwdS$-true}}]
   {
      \strut
   }
   {
      \matchBwd{\seqEmpty}{\kappa}{\alpha}{\matchTrue}{\annTrue{\alpha}}{\elimBool{\kappa}{\hole}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\matchBwdS$-false}}]
   {
      \strut
   }
   {
      \matchBwd{\seqEmpty}{\kappa}{\alpha}{\matchFalse}{\annFalse{\alpha}}{\elimBool{\hole}{\kappa}}
   }
\end{smathpar}
\vspace{1mm}

{\small\flushleft \shadebox{$\envLookupBwd{\rho'}{\rho}{\bind{x}{v}}$}%
\hfill \textbfit{$\bind{x}{v}$ backward-analyses along $\rho$ to $\rho'$}}
\begin{smathpar}
   \inferrule*[
      lab={\ruleName{$\envLookupBwdS$-head}}
   ]
   {
      \strut
   }
   {
      \envLookupBwd{(\hole_{\rho} \concat \bind{x}{u})}
                   {\rho \concat \bind{x}{v}}
                   {\bind{x}{u}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\envLookupBwdS$-tail}},
      right={$x \neq y$}
   ]
   {
      \envLookupBwd{\rho'}{\rho}{\bind{x}{u}}
   }
   {
      \envLookupBwd{(\rho' \concat \bind{y}{\hole})}
                   {\rho \concat \bind{y}{v}}
                   {\bind{x}{u}}
   }
\end{smathpar}
\vspace{1mm}

{\small\flushleft\shadebox{$\rho \closeDefsBwdR \rho', h$}%
\hfill \textbfit{$\rho$ backward-analyses to $\rho'$ and $h$}}
\begin{salign}
   \vec{\bind{x}{v}}
   &\closeDefsBwdR
   (\bigjoin\vec{\rho}, \vec{\bind{x}{\sigma}} \join {\bigjoin\vec{h}})
   &
   \text{ where }
   v_i = \exClosure{\rho_i}{h_i}{\sigma_i}
\end{salign}

\caption{Backward data dependency (Boolean cases for $\evalBwdR{T}$ omitted)}
\label{fig:data-dependencies:bwd}
\end{figure}
