\begin{figure}[H]
\small
$\begin{array}{lll|llll}
   \arrayrulecolor{lightgray}
   &&&\textit{where}
   \\
   \rowcolor{verylightgray}
   \desugarFwdF{s} &::& \Below{e} \to \Below{s}
   & s \desugarFwd e
   &&
   \\
   % binary-apply
   \desugarFwdF{\exBinaryApp{t}{\primOp}{t'}}(\exBinaryApp{s}{\primOp}{s'})
   &=&
   \exApp{\exApp{\exOp{\primOp}}{\desugarFwdF{t}(s)}}{\desugarFwdF{t'}(s')}
   \\
   % nil
   \desugarFwdF{\exNil}(\annNil{\alpha}) &=& \annNil{\alpha}
   \\
   % non-empty-list
   \desugarFwdF{\exList{t}{l}}(\annList{s}{l'}{\alpha})
   &=&
   \annCons{\desugarFwdF{t}(s)}{\desugarFwdF{l}(l')}{\alpha}
   \\
   % cons
   \desugarFwdF{\exCons{t_1}{t_2}}(\annCons{s_1}{s_2}{\alpha})
   &=&
   \annCons{\desugarFwdF{t_1}(s_1)}{\desugarFwdF{t_2}(s_2)}{\alpha}
   \\
   % let-rec
   \desugarFwdF{\exLetRecMutual{\vec{g}}{t}}
               (\exLetRecMutual{\vec{g}'}{s})
   &=&
   \exLetRecMutual{\seqRange{\bind{x_1}{\sigma_1}}{\bind{x_j}{\sigma_j}}}{e}
   &
   g_i,g'_i &=& \bind{x_i}{\vec{c_i}}, \bind{x_i}{\vec{c_i}'}
   \\
   &&&
   \sigma_i &=& \desugarClausesFwdF{\vec{c_i}}(\vec{c_i}')
   \\
   &&&
   e &=& \desugarFwdF{t}(s)
   \\
   % apply
   \desugarFwdF{\exApp{t_1}{t_2}}(\exApp{s_1}{s_2})
   &=&
   \exApp{\desugarFwdF{t_1}(s_1)}{\desugarFwdF{t_2}(s_2)}
   \\
   % if
   \desugarFwdF{\exIfThenElse{t_1}{t_2}{t_3}}(s)
   &=&
   \exApp{\exLambda{\elimBool{e_2}{e_3}}}{\desugarFwdF{t}(s_1)}
   &
   s &=& \exIfThenElse{s_1}{s_2}{s_3}
   \\
   &&&
   e_2, e_3 &=& \desugarFwdF{t_2}(s_2), \desugarFwdF{t_3}(s_3)
   \\
   % match
   \desugarFwdF{\exMatch{t}{\vec{c}}}(\exMatch{s}{\vec{c}'})
   &=&
   \exApp{\exLambda{\sigma}}{\desugarFwdF{t}(s)}
   &
   \sigma &=& \desugarClausesFwdF{\vec{c}}(\vec{c}')
   \\
   % let
   \desugarFwdF{\exLet{p}{t}{t'}}(\exLet{p}{s}{s'})
   &=&
   \exApp{\exLambda{\sigma}}{\desugarFwdF{t}(s)}
   &
   \sigma &=& \desugarClausesFwdF{\clauseUncurried{p}{s'}}(\clauseUncurried{p}{t'})
   \\
   % list-enum
   \desugarFwdF{\exListEnum{t}{t'}}(\exListEnum{s}{s'})
   &=&
   \exApp{\exApp{\funEnumFromTo}{\desugarFwdF{t}(s)}}{\desugarFwdF{t'}(s')}
   \\
   % list-comp-done
   \desugarFwdF{\exListComp{t}{\seqEmpty}}(\annListComp{s}{\seqEmpty}{\alpha})
   &=&
   \annCons{\desugarFwdF{t}(s)}{\annNil{\alpha}}{\alpha}
   \\
   % list-comp-guard
   \desugarFwdF{\exListComp{t}{\qualGuard{t'} \concat \vec{q}}}
               (\annListComp{s}{\qualGuard{s'} \concat \vec{q}'}{\alpha})
   &=&
   \exApp{\exLambda{\elimBool{e}{\annNil{\alpha}}}}{e'}
   &
   e &=& \desugarFwdF{\exListComp{t}{\vec{q}}}(\annListComp{s}{\vec{q}'}{\alpha})
   \\
   &&&
   e' &=& \desugarFwdF{t'}(s')
   \\
   \desugarFwdF{\exListComp{t_1}{\qualDeclaration{p}{t_2} \concat \vec{q}}}
               (s)
   &=&
   \exApp{\exLambda{\sigma}}{\desugarFwdF{t_2}(s_2)}
   &
   s &=& \annListComp{s_1}{\qualDeclaration{p}{s_2} \concat \vec{q}}{\alpha}
   \\
   &&&
   \sigma &=& \desugarClausesFwdF{\clauseUncurried{p}{\exListComp{t_1}{\vec{q}}}}
                                 (\clauseUncurried{p}{\annListComp{s_1}{\vec{q}}{\alpha}})
   \\
   \desugarFwdF{\exListComp{t}{\qualGenerator{p}{t'} \concat \vec{q}'}}
               (\annListComp{s}{\qualGenerator{p}{s'} \concat \vec{q}}{\alpha})
   &=&
   \exApp{\exApp{\funConcatMap}{(\exLambda{\sigma'})}}{\desugarFwdF{t'}(s')}
   &
   \sigma &=&
   \desugarClausesFwdF{\clauseUncurried{p}{\exListComp{t}{\vec{q}'}}}
                      (\clauseUncurried{p}{\annListComp{s}{\vec{q}}{\alpha}})
   \\
   &&&
   \sigma' &=& \totaliseFwdF{p}(\sigma,\alpha)
\end{array}$
\caption{Desugaring terms --- forward slicing}
\end{figure}
