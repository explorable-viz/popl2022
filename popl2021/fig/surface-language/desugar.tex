\begin{figure}[H]
\flushleft \shadebox{$s \darrow e$}
\begin{smathpar}
\inferrule*[
   lab={\ruleName{$\darrow$-nil}}
]
{
   \strut
}
{
   \sExNil \darrow \exNil
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\darrow$-cons}}
]
{
   s \darrow e
   \\
   \overrightarrow{s} \darrow e'
}
{
   \sExCons{s}{\overrightarrow{s}} \darrow \exCons{e}{e'}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\darrow$-match-as}}
]
{
   s \darrow e
}
{
   \exMatch{s}{\sigma} \darrow \exLambda{\sigma} \ e
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\darrow$-if-then-else}}
]
{
   s \darrow e
   \\
   s' \darrow e'
   \\
   s^{\twoPrime} \darrow e^{\twoPrime}
}
{
   \exIfThenElse{s}{s'}{s^{\twoPrime}} \darrow \exMatch{e}{\elimBool{e'}{e^{\twoPrime}}}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\darrow$-list-range}},
]
{
   s \darrow e
   \\
   s' \darrow e'
}
{
   \exListSeq{s}{s'} \darrow \range{e}{e'}
}
%
\and
%
\inferrule*[lab={\ruleName{$\darrow$-list-comp-true}}]
{
   s \darrow e
}
{
   \exListComp{s}{\exTrue} \darrow \exCons{e}{\exNil}
}
\and
%
\inferrule*[lab={\ruleName{$\darrow$-list-comp-qual}},
   right={$q \neq \kw{true}$}
]
{
  \exListComp{s}{q, \exTrue} \darrow e
}
{
   \exListComp{s}{q} \darrow e
}
\and
%
\inferrule*[lab={\ruleName{$\darrow$-list-comp-guard}}]
{
   \exIfThenElse{s'}{\exListComp{s}{\overrightarrow{q}}}{\sExNil}
   \darrow e
}
{
   \exListComp{s}{s', \overrightarrow{q}}
   \darrow e
}
\and
%
\inferrule*[lab={\ruleName{$\darrow$-list-comp-decl}}]
{
   s' \darrow e'
   \\
   \exListComp{s}{\overrightarrow{q}} \darrow e
   \\
   \sigma = \kw{branch} \ p \ e
}
{
   \exListComp{s}{\qualDeclaration{p}{s'}, \overrightarrow{q}}
   \darrow
   \exLambda{\sigma} \ e'
}
\and
%
\inferrule*[lab={\ruleName{$\darrow$-list-comp-gen}}]
{
   \exListComp{s}{\overrightarrow{q}} \darrow e
   \\
   \sigma = \kw{totalise}(\kw{branch} \ p \ e, \kw{Nil})
   \\
   s' \darrow e'
}
{
   \exListComp{s}{\qualGenerator{p}{s'}, \overrightarrow{q}}
   \darrow
   \kw{concatMap} \ \exLambda{\sigma} \ e'
}
\end{smathpar}
\caption{Desugaring}
\end{figure}
