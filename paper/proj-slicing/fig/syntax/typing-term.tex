\begin{figure}
\flushleft \shadebox{$\exprType{e}{\Gamma}{A}$}
\begin{smathpar}
\inferrule*[right={$x : A \in \Gamma$}]
{
   \strut
}
{
   \exprType{\exVar{x}}{\Gamma}{A}
}
%
\and
%
\inferrule*
{
}
{
   \exprType{\exUnit}{\Gamma}{\tyUnit}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{A}
}
{
   \exprType{\exInl{e}}{\Gamma}{\tySum{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{B}
}
{
   \exprType{\exInr{e}}{\Gamma}{\tySum{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e_1}{\Gamma}{A}
   \\
   \exprType{e_2}{\Gamma}{B}
}
{
   \exprType{\exPair{e_1}{e_2}}{\Gamma}{\tyProd{A}{B}}
}
%
\and
%
\inferrule*
{
   \trieType{\sigma}{B}{A}{\Gamma}
}
{
   \exprType{\exFun{\sigma}}{\Gamma}{\tyFun{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{\tyFun{A}{B}}
   \\
   \exprType{e'}{\Gamma}{A}
}
{
   \exprType{\exApp{e}{e'}}{\Gamma}{B}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{\subst{A}{\tyRec{X}{A}}{\alpha}}
}
{
   \exprType{\exRoll{e}}{\Gamma}{\tyRec{X}{A}}
}
\end{smathpar}
\\[3mm]
\flushleft \shadebox{$\trieType{\sigma}{B}{A}{\Gamma}$}
\begin{smathpar}
\inferrule*
{
   \contType{\kappa}{B}{\cxtExtend{\Gamma}{x}{A}}
}
{
   \trieType{\trieVar{x}{\kappa}}{B}{A}{\Gamma}
}
%
\and
%
\inferrule*
{
   \contType{\kappa}{B}{\Gamma}
}
{
   \trieType{\trieUnit{\kappa}}{B}{\tyUnit}{\Gamma}
}
%
\and
%
\inferrule*
{
   \trieType{\sigma}{B}{A}{\Gamma}
   \\
   \trieType{\tau}{B}{A'}{\Gamma}
}
{
   \trieType{\trieSum{\sigma}{\tau}}{B}{\tySum{A}{A'}}{\Gamma}
}
%
\and
%
\inferrule*
{
   \trieType{\sigma}{\trieTypePartial{B}{A'}}{A}{\Gamma}
}
{
   \trieType{\trieProd{\sigma}}{B}{\tyProd{A}{A'}}{\Gamma}
}
%
\and
%
\inferrule*
{
   \trieType{\sigma}{B}{\subst{A}{\tyRec{\tyVar{X}}{A}}{\alpha}}{\Gamma}
}
{
   \trieType{\trieRoll{\sigma}}{B}{(\tyRec{\tyVar{X}}{A})}{\Gamma}
}
\end{smathpar}
\caption{Typing rules for annotated terms and tries}
\label{fig:demand-indexed:typing-term}
\end{figure}
