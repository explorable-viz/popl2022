\begin{figure}
\flushleft \shadebox{$\exprType{e}{\Gamma}{A}$}
\begin{smathpar}
\inferrule*
{
   \exprType{e}{\Gamma}{A}
}
{
   \exprType{\del{e}}{\Gamma}{\del{A}}
}
%
\and
%
\inferrule*[right={$x : A \in \Gamma$}]
{
   \strut
}
{
   \exprType{\exVar{x}}{\Gamma}{A}
}
%
\and
%
\inferrule*
{
}
{
   \exprType{\exUnit}{\Gamma}{\tyUnit}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{A}
}
{
   \exprType{\exInl{e}}{\Gamma}{\tySum{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{A}
}
{
   \exprType{\exInlProj{e}}{\Gamma}{\tySumProjL{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{B}
}
{
   \exprType{\exInr{e}}{\Gamma}{\tySum{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{B}
}
{
   \exprType{\exInrProj{e}}{\Gamma}{\tySumProjR{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e_1}{\Gamma}{A}
   \\
   \exprType{e_2}{\Gamma}{B}
}
{
   \exprType{\exPair{e_1}{e_2}}{\Gamma}{\tyProd{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e_1}{\Gamma}{A}
   \\
   \exprType{e_2}{\Gamma}{B}
}
{
   \exprType{\exPairProjL{e_1}{e_2}}{\Gamma}{\tyProdProjL{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e_1}{\Gamma}{A}
   \\
   \exprType{e_2}{\Gamma}{B}
}
{
   \exprType{\exPairProjR{e_1}{e_2}}{\Gamma}{\tyProdProjR{A}{B}}
}
%
\and
%
\inferrule*
{
   \trieType{\sigma}{B}{A}{\Gamma}
}
{
   \exprType{\exFun{\sigma}}{\Gamma}{\tyFun{A}{B}}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{\tyFun{A}{B}}
   \\
   \exprType{e'}{\Gamma}{A}
}
{
   \exprType{\exApp{e}{e'}}{\Gamma}{B}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{\tyFun{A}{\tyFunProjR{A'}{B}}}
   \\
   \exprType{e'}{\Gamma}{A'}
}
{
   \exprType{\exAppProjFun{e}{e'}}{\Gamma}{B}
}
%
\and
%
\inferrule*
{
   \exprType{e}{\Gamma}{\subst{A}{\tyRec{X}{A}}{X}}
}
{
   \exprType{\exRoll{e}}{\Gamma}{\tyRec{X}{A}}
}
%
\and
%
\inferrule*[right={\textnormal{$A$ closed}}]
{
   \exprType{e}{\Gamma}{\subst{A}{\tyRec{X}{A}}{X}}
}
{
   \exprType{\exRollProj{e}}{\Gamma}{\tyRecProj{X}{A}}
}
\end{smathpar}
\\[3mm]
\flushleft \shadebox{$\Gamma \vdash \sigma: A \to B$}
\begin{smathpar}
\inferrule*
{
   \cxtExtend{\Gamma}{x}{A} \vdash \kappa: B
}
{
   \Gamma \vdash \trieVar{x}{\kappa}: A \to B
}
%
\and
%
\inferrule*
{
   \cxtExtendProj{\Gamma}{x}{A} \vdash \kappa: B
}
{
   \Gamma \vdash \trieVarProj{x}{\kappa}: \tyFunProjR{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \kappa: B
}
{
   \Gamma \vdash \trieUnit{\kappa}: \tyFun{\tyUnit}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \kappa: B
}
{
   \Gamma \vdash \trieUnitProj{\kappa}: \tyFunProjR{\tyUnit}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
   \\
   \Gamma \vdash \tau: \tyFun{A'}{B}
}
{
   \Gamma \vdash \trieSum{\sigma}{\tau}: \tyFun{\tySum{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
   \\
   \Gamma \vdash \tau: \tyFun{A'}{B}
}
{
   \Gamma \vdash \trieSumProjL{\sigma}{\tau}: \tyFun{\tySumProjL{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
   \\
   \Gamma \vdash \tau: \tyFun{A'}{B}
}
{
   \Gamma \vdash \trieSumProjR{\sigma}{\tau}: \tyFun{\tySumProjR{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \trieType{\sigma}{\trieTypePartial{B}{A'}}{A}{\Gamma}
}
{
   \trieType{\trieProd{\sigma}}{B}{\tyProd{A}{A'}}{\Gamma}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{\subst{A}{\tyRec{\tyVar{X}}{A}}{X}}{B}
}
{
   \Gamma \vdash \trieRoll{\sigma}: \tyFun{(\tyRec{\tyVar{X}}{A})}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{\subst{A}{\tyRec{\tyVar{X}}{A}}{X}}{B}
}
{
   \Gamma \vdash \trieRollProj{\sigma}: \tyFun{(\tyRecProj{\tyVar{X}}{A})}{B}
}
\end{smathpar}
\caption{Typing rules for terms and tries}
\end{figure}
