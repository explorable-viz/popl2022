\begin{figure}
\flushleft \shadebox{$\exprType{e}{\Gamma}{A}$}
\begin{smathpar}
\inferrule*[right={$x : A \in \Gamma$}]
{
   \strut
}
{
   \Gamma \vdash \exVar{x}: A
}
%
\and
%
\inferrule*
{
}
{
   \Gamma \vdash \exUnit: \tyUnit
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e: A
}
{
   \Gamma \vdash \exInl{e}: \tySum{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e: A
}
{
   \Gamma \vdash \exInlProj{e}: \tySumProjL{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e: B
}
{
   \Gamma \vdash \exInr{e}: \tySum{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e: B
}
{
   \Gamma \vdash \exInrProj{e}: \tySumProjR{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e_1: A
   \\
   \Gamma \vdash e_2: B
}
{
   \Gamma \vdash \exPair{e_1}{e_2}: \tyProd{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e_1: A
   \\
   \Gamma \vdash e_2: B
}
{
   \Gamma \vdash \exPairProjL{e_1}{e_2}: \tyProdProjL{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e_1: A
   \\
   \Gamma \vdash e_2: B
}
{
   \Gamma \vdash \exPairProjR{e_1}{e_2}: \tyProdProjR{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
}
{
   \Gamma \vdash \exFun{\sigma}: \tyFun{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \trieSingletonProj{\sigma}{\exFun{\tau}}: \tyFunProjR{A}{\tyFun{A'}{B}}
}
{
   \Gamma \vdash \exFunProj{\trieSingletonProj{\sigma}{\exFun{\tau}}}: \tyFunProjR{A}{\tyFun{A'}{B}}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e: \tyFun{A}{B}
   \\
   \Gamma \vdash e': A
}
{
   \Gamma \vdash \exApp{e}{e'}: B
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e: \tyFun{A}{\tyFunProjR{A'}{B}}
   \\
   \Gamma \vdash e': A'
}
{
   \Gamma \vdash \exAppProjFun{e}{e'}: B
}
%
\and
%
\inferrule*
{
   \Gamma \vdash e: \subst{A}{\tyRec{X}{A}}{X}
}
{
   \Gamma \vdash \exRoll{e}: \tyRec{X}{A}
}
%
\and
%
\inferrule*[right={\textnormal{$A$ closed}}]
{
   \Gamma \vdash e: A
}
{
   \Gamma \vdash \exRollProj{e}: \tyRecProj{X}{A}
}
\end{smathpar}
\\[3mm]
\flushleft \shadebox{$\Gamma \vdash \sigma: A \to B$}
\begin{smathpar}
\inferrule*
{
   \cxtExtend{\Gamma}{x}{A} \vdash \kappa: B
}
{
   \Gamma \vdash \trieVar{x}{\kappa}: A \to B
}
%
\and
%
\inferrule*
{
   \cxtExtendProj{\Gamma}{x}{A} \vdash \kappa: B
}
{
   \Gamma \vdash \trieVarProj{x}{\kappa}: \tyFunProjR{A}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \kappa: B
}
{
   \Gamma \vdash \trieUnit{\kappa}: \tyFun{\tyUnit}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \kappa: B
}
{
   \Gamma \vdash \trieUnitProj{\kappa}: \tyFunProjR{\tyUnit}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
   \\
   \Gamma \vdash \tau: \tyFun{A'}{B}
}
{
   \Gamma \vdash \trieSum{\sigma}{\tau}: \tyFun{\tySum{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
   \\
   \Gamma \vdash \tau: \tyFun{A'}{B}
}
{
   \Gamma \vdash \trieSumProjL{\sigma}{\tau}: \tyFun{\tySumProjL{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
   \\
   \Gamma \vdash \tau: \tyFun{A'}{B}
}
{
   \Gamma \vdash \trieSumProjR{\sigma}{\tau}: \tyFun{\tySumProjR{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{\tyFun{A'}{B}}
}
{
   \Gamma \vdash \trieProd{\sigma}: \tyFun{\tyProd{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFunProjR{A}{\tyFun{A'}{B}}
}
{
   \Gamma \vdash \trieProdProj{\sigma}: \tyFun{\tyProdProjR{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{A}{\tyFunProjR{A'}{B}}
}
{
   \Gamma \vdash \trieProdProj{\sigma}: \tyFun{\tyProdProjL{A}{A'}}{B}
}
%
\and
%
\inferrule*
{
   \Gamma \vdash \sigma: \tyFun{\subst{A}{\tyRec{\tyVar{X}}{A}}{X}}{B}
}
{
   \Gamma \vdash \trieRoll{\sigma}: \tyFun{(\tyRec{\tyVar{X}}{A})}{B}
}
%
\and
%
\inferrule*[right={\textnormal{$A$ closed}}]
{
   \Gamma \vdash \sigma: \tyFun{A}{B}
}
{
   \Gamma \vdash \trieRollProj{\sigma}: \tyFun{(\tyRecProj{\tyVar{X}}{A})}{B}
}
\end{smathpar}
\caption{Typing rules for terms and tries}
\end{figure}
