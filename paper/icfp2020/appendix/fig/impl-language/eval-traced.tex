\begin{figure}[p]
\flushleft \shadebox{$\rho, e \eval{} T, u$}
\begin{smathpar}
   \inferrule*[left={\ruleName{$\eval{}$-annot}}]
   {
      \rho, r
      \eval{}
      T, \annot{v}{\alpha'}
   }
   {
      \rho,
      \annot{r}{\alpha}
      \eval{}
      T, \annot{v}{\alpha \wedge \alpha'}
   }
\end{smathpar}
\\
\flushleft \shadebox{$\rho, r \eval{} T, u$}
\begin{smathpar}
   \inferrule*[
      left={\ruleName{$\eval{}$-var}},
      right={\textnormal{$\exThunkVar{x}{u} \in \rho$}}
   ]
   {
      \strut
   }
   {
      \rho, \exVar{x} \eval{} \trVarTwo{x}{\rho}, u
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-const}}]
   {
      \strut
   }
   {
      \rho,
      \exConst{k}
      \eval{}
      \sub{\trEmpty}{\rho}, \exConst{k}
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-op}}]
   {
      \strut
   }
   {
      \rho,
      \phi
      \eval{}
      \sub{\trEmpty}{\rho}, \phi
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-fun}}]
   {
      \strut
   }
   {
      \rho,
      \exFun{\sigma}
      \eval{}
      \sub{\trEmpty}{\rho}, \exClosureNew{\rho}{\seqEmpty}{\exFun{\sigma}}
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-app}}]
   {
      \rho, e \eval{} T, \annot{\exClosureNew{\rho_1}{\delta}{\exFun{\sigma}}}{\alpha}
      \\
      \rho_1, \delta \closeDefs \rho_2
      \\
      \rho, e' \eval{} T', u
      \\
      u, \sigma \lookupR \rho_3, \matchPlug{\xi}{e^\twoPrime}, \alpha'
      \\
      \rho_1 \concat \rho_2 \concat \rho_3, e^\twoPrime
      \eval{}
      U, \annot{v}{\alpha^\twoPrime}
   }
   {
      \rho,
      \exApp{e}{e'}
      \eval{}
      \trApp{T}{T'}{\matchPlug{\xi}{U}},
      \annot{v}{\alpha \wedge \alpha' \wedge \alpha^\twoPrime}
   }
   %
   \and
   %
   \inferrule*[
      left={\ruleName{$\eval{}$-app-unary}},
      right={\textnormal{$k \in \dom{\interpret{\phi}}$}}
   ]
   {
      \rho, e \eval{} \explVal{T}{\annot{\phi}{\alpha}}
      \\
      \rho, e' \eval{} \explVal{T'}{\annot{k}{\alpha'}}
   }
   {
      \rho,
      \exApp{e}{e'}
      \eval{}
      \trUnaryApp{(\explVal{T}{\phi})}{(\explVal{T'}{\exConst{k}})},
      \annot{\interpret{\phi}(k)}{\alpha \wedge \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      left={\ruleName{$\eval{}$-app-binary}},
      right={\textnormal{$(k, k') \in \dom{\interpret{\primOp}}$
      }}
   ]
   {
      \rho, e \eval{} \explVal{T}{\annot{k}{\alpha'}}
      \\
      \rho, e' \eval{} \explVal{T'}{\annot{k'}{\smash{\alpha^\twoPrime}}}
   }
   {
      \rho,
      \exPrimApp{e}{\annot{\primOp}{\alpha}}{e'}
      \eval{}
      \trPrimApp{(\explVal{T}{k})}{\primOp}{(\explVal{T'}{k'})},
      \annot{\interpret{\primOp}(k, k')}{\smash{\alpha \wedge \alpha' \wedge \alpha^\twoPrime}}
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-constr}}]
   {
      \rho,
      \vec{e}
      \eval{}
      \vec{\explVal{T}{u}}
   }
   {
      \rho,
      \exConstr{d}{\vec{e}}
      \eval{}
      \explVal{\sub{\trEmpty}{\rho}}{\exConstr{d}{\vec{\explVal{T}{u}}}}
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-match}}]
   {
      \rho, e \eval{} \explVal{T}{u}
      \\
      u, \sigma \lookupR \rho_1, \matchProd{\xi}{e'}, \alpha
      \\
      \rho \concat \rho_1, e' \eval{} \explVal{T'}{\annot{v}{\alpha'}}
   }
   {
      \rho,
      \exMatch{e}{\sigma}
      \eval{}
      \explVal{\trMatch{T}{\matchPlug{\xi}{T'}}}{\annot{v}{\alpha \wedge \alpha'}}
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-let}}]
   {
      \rho, e \eval{} \explVal{T}{u}
      \\
      \envExtend{\rho}{x}{u}, e' \eval{} \explVal{U}{u'}
   }
   {
      \rho, \exLet{x}{e}{e'}
      \eval{}
      \explVal{\trLet{x}{\explVal{T}{u}}{U}}{u'}
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-letrec}}]
   {
      \rho, \delta \closeDefs \rho_1
      \\
      \rho \concat \rho_1, e \eval{} \explVal{T}{u}
   }
   {
      \rho, \exLetrec{\delta}{e}
      \eval{}
      \explVal{\trLetrec{\delta}{T}}{u}
   }
   %
   \and
   %
   \inferrule*[left={\ruleName{$\eval{}$-defs}}]
   {
      \rho, \vec{d} \closeDefs \rho_1, \vec{z}
      \\
      \rho \concat \rho_1, e \eval{} \explVal{T}{u}
   }
   {
      \rho, \exDefs{\vec{d}}{e}
      \eval{}
      \explVal{\trDefs{\vec{z}}{T}}{u}
   }
\end{smathpar}
\vspace{5pt}

\flushleft \shadebox{$\rho, \vec{e} \eval{} \vec{\explVal{T}{u}}$}
\begin{smathpar}
   \inferrule*
   {
      \strut
   }
   {
      \rho,
      \exUnit
      \eval{}
      \seqEmpty
   }
   \and
   %
   \inferrule*
   {
      \rho, e \eval{} \explVal{T}{u}
      \\
      \rho, \vec{e} \eval{} \vec{\explVal{T}{u}}
   }
   {
      \rho,
      e \concat \vec{e}
      \eval{}
      (\explVal{T}{u}) \concat (\vec{\explVal{T}{u}})
   }
\end{smathpar}
\caption{Evaluation for terms and term sequences}
\end{figure}
