\begin{figure*}
\fbox{$\match{v:\tau}{\vec{\exBranch{p}{e}}}$}
\begin{align*}
\match{v:\tau}{\vec{\exBranch{p}{e}}}
&=
\catMaybes{\match{v:\tau}{\exBranch{p_1}{e_1}}, \ldots, \match{v:\tau}{\exBranch{p_n}{e_n}}}
\\
\intertext{where}
\catMaybes{\some{x}, \vec{y}}
&=
x, \catMaybes{\vec{y}}
\\
\catMaybes{\none, \vec{y}}
&=
\catMaybes{\vec{y}}
\end{align*}
\\
\fbox{$\match{v:\tau}{\exBranch{p}{e}}$}
\begin{align*}
\match{\exSuspend{e'}:\tau}{\exBranch{x}{e}}
&=
\some{
\begin{cases}
\;\subst{r}{x}{e}
&
\text{if }e' = r
\\
\;\subst{\exAnnot{e'}{\tau}}{x}{e}
& \text{otherwise}
\end{cases}
}
\\
\match{\exUnit:\tyUnit}{\exBranch{\exUnit}{e}}
&=
\some{e}
\\
\match{\exInl{v}:\tySum{\tau_1}{\tau_2}}{\exBranch{\exInl{p}}{e}}
&=
\match{v:\tau_1}{\exBranch{p}{e}}
\\
\match{\exInl{v}:\tySum{\tau_1}{\tau_2}}{\exBranch{\exInr{p}}{e}}
&=
\none
\\
\match{\exInr{v}:\tySum{\tau_1}{\tau_2}}{\exBranch{\exInr{p}}{e}}
&=
\match{v:\tau_2}{\exBranch{p}{e}}
\\
\match{\exInr{v}:\tySum{\tau_1}{\tau_2}}{\exBranch{\exInl{p}}{e}}
&=
\none
\\
\match{\exPair{v_1}{v_2}:\tyProd{\tau_1}{\tau_2}}{\exBranch{\exPair{p_1}{p_2}}{e}}
&=
\match{v_1:\tau_1}{\exBranch{p_1}{e}} \bind \match{v_2:\tau_2}{\exBranch{p_2}{-}}
\\
\match{\exRoll{v}:\tyRec{\alpha}{\tau}}{\exBranch{\exRoll{p}}{e}}
&=
\match{v:\subst{\tyRec{\alpha}{\tau}}{\alpha}{\tau}}{\exBranch{p}{e}}
\\
\intertext{where}
\some{x} \bind f
&= f x
\\
\none \bind f
&= \none
\end{align*}
\caption{Branch matching}
\label{fig:match}
\end{figure*}
