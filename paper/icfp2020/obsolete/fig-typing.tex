\begin{figure}
\fbox{$\Gamma \vdash e \tycheck \tau$}
\begin{smathpar}
  \inferrule*
  {
    \Gamma \vdash r \synth \tau
  }
  {
    \Gamma \vdash r \tycheck \tau
  }
%
\and
%
  \inferrule*
  {
    \Gamma \vdash e \tycheck \tau_1
  }
  {
    \Gamma \vdash \exInl{e} \tycheck \tySum{\tau_1}{\tau_2}
  }
%
\and
%
  \inferrule*
  {
    \Gamma \vdash r \synth \sigma
    \\
    \Gamma;\vec{p} \tycheck \sigma \vdash \vec{e} \tycheck \tau
  }
  {
    \Gamma
    \vdash \exMatch{r}{\vec{\exBranch{p}{e}}} \tycheck \tau
  }
%
\and
%
  \inferrule*
  {
    \Gamma \vdash e_1 \tycheck \tau_1
    \\
    \Gamma \vdash e_2 \tycheck \tau_2
  }
  {
    \Gamma
    \vdash \exPair{e_1}{e_2} \tycheck \tyProd{\tau_1}{\tau_2}
  }
%
\and
%
  \inferrule*
  {
    \cxtExtend{\Gamma}{f}{\tyFun{\sigma}{\tau}};\vec{p} \tycheck \sigma \vdash \vec{e} \tycheck \tau
  }
  {
    \Gamma \vdash \exFun{f}{\vec{\exBranch{p}{e}}}
    \tycheck \tyFun{\sigma}{\tau}
  }
%
\and
%
  \inferrule*
  {
    \Gamma \vdash e \tycheck \subst{\tyRec{\alpha}{\tau}}{\alpha}{\tau}
  }
  {
    \Gamma \vdash \exRoll{e} \tycheck \tyRec{\alpha}{\tau}
  }
\end{smathpar}
\\
\fbox{$\Gamma \vdash r \synth \tau$}
\begin{smathpar}
  \inferrule*
  {
    \Gamma \vdash e \tycheck \tau
  }
  {
    \Gamma \vdash \exAnnot{e}{\tau} \synth \tau
  }
%
\and
%
  \inferrule*[right={$x : \tau \in \Gamma$}]
  {
    \strut
  }
  {
    \Gamma \vdash x \synth \tau
  }
%
\and
%
  \inferrule*
  {
    \strut
  }
  {
    \Gamma \vdash \exUnit \synth \tyUnit
  }
%
\and
%
  \inferrule*
  {
    \Gamma \vdash r \synth \tyProd{\tau_1}{\tau_2}
  }
  {
    \Gamma \vdash \exFst{r} \synth \tau_1
  }
%
\and
%
  \inferrule*
  {
    \Gamma \vdash r \synth \tyFun{\sigma}{\tau}
    \\
    \Gamma \vdash e \tycheck \sigma
  }
  {
    \Gamma \vdash \exApp{r}{e} \synth \tau
  }
%
\and
%
  \inferrule*
  {
    \Gamma \vdash r \synth \tyRec{\alpha}{\tau}
  }
  {
    \Gamma \vdash \exUnroll{r} \synth \subst{\tyRec{\alpha}{\tau}}{\alpha}{\tau}
  }
\end{smathpar}
\caption{Expression typing}
\label{fig:typing}
\end{figure}
