\begin{figure}
\fbox{$e \eval_{u} v$}
\begin{smathpar}
  \inferrule*
  {
    r
    \seval_{u}
    v \synth \tau
  }
  {
    r
    \eval_{u}
    v
  }
%
\and
%
  \inferrule*
  {
    \strut
  }
  {
    e
    \eval_{\bot}
    \exSuspend{e}
  }
%
\and
%
  \inferrule*
  {
    e \eval_{u_1} v
  }
  {
    \exInl{e}
    \eval_{\exInlr{u_1}{u_2}}
    \exInl{v}
  }
%
\and
%

  \inferrule*[right={$u \sqgt \bot$,
                      \textnormal{$\match{v:\sigma}{\vec{\exBranch{p}{e}}} \equal e'$}}]
  {
    r \seval_{\demand{\vec{p}}} v \synth \sigma
    \\
    e' \eval_{u} v'
  }
  {
    \exMatch{r}{\vec{\exBranch{p}{e}}}
    \eval_{u}
    v'
  }
%
\and
%
  \inferrule*
  {
    e_1 \eval_{u_1} v_1
    \\
    e_2 \eval_{u_2} v_2
  }
  {
    \exPair{e_1}{e_2}
    \eval_{\exPair{u_1}{u_2}}
    \exPair{v_1}{v_2}
  }
%
\and
%
  \inferrule*
  {
    \strut
  }
  {
    \exFun{f}{\vec{\exBranch{p}{e}}}
    \eval_{\exRecDemand}
    \exFun{f}{\vec{\exBranch{p}{e}}}
  }
%
\and
%
  \inferrule*
  {
    e \eval_{u} v
  }
  {
    \exRoll{e}
    \eval_{\tyRoll{u}}
    \exRoll{v}
  }
\end{smathpar}
\\
\fbox{$r \seval_{u} v \synth \tau$}
\begin{smathpar}
  \inferrule*[right={$u \sqgt \bot$}]
  {
    e
    \eval_{u}
    v
  }
  {
    \exAnnot{e}{\tau}
    \seval_{u}
    v \synth \tau
  }
%
\and
%
  \inferrule*[right={$\cxtEmpty \vdash r \synth \tau$}]
  {
    \strut
  }
  {
    r
    \seval_{\bot}
    \exSuspend{r} \synth \tau
  }
%
\and
%
  \inferrule*
  {
    \strut
  }
  {
    \exUnit
    \seval_{\exUnit}
    \exUnit \synth \tyUnit
  }
%
\and
%
  \inferrule*[right={$u \sqgt \bot$}]
  {
    r
    \seval_{\exPair{u}{\bot}}
    \exPair{v_1}{v_2}
    \synth \tyProd{\tau_1}{\tau_2}
  }
  {
    \exFst{r}
    \seval_{u}
    v_1 \synth \tau_1
  }
%
\and
%
  \inferrule*[right={$u \sqgt \bot$}]
  {
    r
    \seval_{\exPair{\bot}{u}}
    \exPair{v_1}{v_2}
    \synth \tyProd{\tau_1}{\tau_2}
  }
  {
    \exSnd{r}
    \seval_{u}
    v_2 \synth \tau_2
  }
%
\and
%
  \inferrule*[right={$u \sqgt \bot$,
                      \textnormal{$\match{v:\sigma}{\vec{\exBranch{p}{e'}}} \equal e''$}}]
  {
    r \seval_{\exRecDemand} \exFun{f}{\vec{\exBranch{p}{e'}}} \synth \tyFun{\sigma}{\tau}
    \\
    e \eval_{\demand{\vec{p}}} v
    \\
    \subst{\exAnnot{\exFun{f}{\vec{\exBranch{p}{e'}}}}{\tyFun{\sigma}{\tau}}}{f}
          {e''}
    \eval_{u} v'
  }
  {
    \exApp{r}{e}
    \seval_{u}
    v' \synth \tau
  }
%
\and
%
  \inferrule*[right={$u \sqgt \bot$}]
  {
    r
    \seval_{\exRoll{u}}
    \exRoll{v} \synth \tyRec{\alpha}{\tau}
  }
  {
    \exUnroll{r}
    \seval_{u}
    v \synth \subst{\tyRec{\alpha}{\tau}}{\alpha}{\tau}
  }
\end{smathpar}
\caption{Demand-indexed evaluation}
\label{fig:eval}
\end{figure}
