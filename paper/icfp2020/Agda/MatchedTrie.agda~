-- Adapted from Hinze's "Generalizing Generalized Tries", via Conal Elliott's blog.
module Trie where

   open import SharedModules hiding (Â¬_)

   open import Cxt as á¶œ using (Â«Ren; weakenáµ£â€ );
      open á¶œ.Cxt; open á¶œ.Substitutable â¦ƒ...â¦„ hiding (_<$>_; var)
   import Type
   open import VarCxt as áµ›á¶œ using (VarCxt; Type); open áµ›á¶œ.Type

   -- Trie over X, with domain A. TODO: surface syntax to hide [] argument to shiftable substitution.
   mutual
      data Trie (X : VarCxt â†’ Set) : Type â†’ VarCxt â†’ Set where
         Îµ : âˆ€ {A Î“} â†’ Î“ âŠ¢ A â‡€ X
         any : âˆ€ {A Î“} â†’ X (Î“ â€š A) â†’ Î“ âŠ¢ A â‡€ X
         [_] : âˆ€ {A Î“} â†’ Î“ âŠ¢ A â‡€â» X â†’ Î“ âŠ¢ A â‡€ X

      data Trieâ» (X : VarCxt â†’ Set) : Type â†’ VarCxt â†’ Set where
         nat : âˆ€ {Î“} â†’ X Î“ â†’ Î“ âŠ¢ nat â‡€â» X
         âŒ©âŒª : âˆ€ {Î“} â†’ X Î“ â†’ Î“ âŠ¢ ğŸ â‡€â» X
         âŸ…_,_âŸ† : âˆ€ {A B Î“} â†’ Î“ âŠ¢ A â‡€ X â†’ Î“ âŠ¢ B â‡€ X â†’ Î“ âŠ¢ A + B â‡€â» X
         â†¥ : âˆ€ {A B Î“} â†’ Î“ âŠ¢ A â‡€ (Î» Î“ â†’ Î“ âŠ¢ B â‡€ X) â†’ Î“ âŠ¢ A â¨° B â‡€â» X
         fun : âˆ€ {A B Î“} â†’ X Î“ â†’ Î“ âŠ¢ A â‡¾ B â‡€â» X
         roll : âˆ€ {A Î“} â†’ Î“ âŠ¢ ((sub (const (Î¼ A)) * []) A) â‡€ X â†’ Î“ âŠ¢ Î¼ A â‡€â» X
