\newcommand\grayuline{\bgroup\markoverwith{\textcolor{gray}{\rule[-0.9ex]{2pt}{0.4pt}}}\ULon}
% \newcommand*{\del}[1]{\grayuline{\textcolor{gray}{\smash{#1}}}}
\newcommand*{\del}[1]{\textcolor{red}{#1}}
\newcommand*{\sel}[1]{\textcolor{blue}{#1}}
% \let\oldtop\top
% \renewcommand{\top}{\sel{\oldtop}}
\newcommand*{\Sel}[1]{[#1]}
\newcommand*{\TT}{\mathsf{tt}}
\newcommand*{\FF}{\mathsf{ff}}

\renewcommand*{\ldots}{...} % \ldots sucks with acmart
\renewcommand*{\ruleName}[1]{\textcolor{gray}{\textnormal{\textsf{#1}}}}

% Section symbol.
\renewcommand*{\secref}{\Secref}
\renewcommand*{\secrefTwo}{\SecrefTwo}

% Use this in place of \mathsf.
\newcommand*{\mathSf}[1]{\textup{\textsf{#1}}}
\newcommand*{\Set}[1]{\mathSf{#1}}

\newcommand*{\Int}{\mathbb{Z}}
\newcommand*{\Pow}[1]{\MnSymbolpowerset({#1})}
\newcommand*{\id}{\textsf{id}}
\newcommand*{\adjoint}{\dashv}
\newcommand*{\inj}{\hookrightarrow}

% Vectors.
\newcommand*{\override}{\reloverrideleft}
\newcommand*{\seqEmpty}{\varepsilon}

% Misc.
\newcommand*{\envExtendTwo}[2]{{#1}[#2]}
\newcommand*{\Dagger}[1]{\smash{#1^\dagger}}
\newcommand*{\DDagger}[1]{\smash{#1^\ddagger}}
\newcommand*{\closeDefs}{\mathrel{\rightharpoonup}}
\newcommand*{\closeDefsFwd}{\mathrel{\rotatebox[origin=c]{45}{$\rightharpoonup$}}}
\newcommand*{\closeDefsBwd}{\mathrel{\rotatebox[origin=c]{-45}{$\rightharpoonup$}}}

% Misc. syntax.
\newcommand*{\asMap}[1]{\underline{#1}}
\newcommand*{\trace}[2]{\textcolor{gray}{#1}\mathrel{\textcolor{gray}{::}}{#2}}

% Relations.
\newcommand*{\numLabel}[1]{\textcolor{blue}{\mathSf{#1}}}

% Primitives.
\newcommand*{\primOp}{\oplus}

% Annotations.
\newcommand*{\annot}[2]{#1_{#2}}

\newcommand*{\symCons}{\textbf{\kw{:}}}

% Expressions.
%\newcommand*{\exAdd}[2]{{#1} + {#2}}
\newcommand*{\exApp}[2]{{#1}\,{#2}}
\newcommand*{\exBinaryApp}[3]{{#1} \mathbin{#2} {#3}}
\newcommand*{\exCons}[2]{{#1}\,\symCons\,{#2}}
\newcommand*{\exClosure}[3]{(#1,#2,\exLambda{#3})}
\newcommand*{\exClosureRec}[3]{(#1,\exRec{#2}{#3})}
\newcommand*{\exFalse}{\kw{false}}
\newcommand*{\exFun}[2]{#1\,#2}
\newcommand*{\sExList}[2]{\kw{[}#1 \ #2}
\newcommand*{\exList}[1]{\kw{[}\;{#1}\;\kw{]}}
\newcommand*{\exListSeq}[2]{\kw{[}\;{#1}\;\kw{..}\;{#2}\;\kw{]}}
\newcommand*{\exListComp}[2]{\kw{[}\;{#1}\;\kw{$\vert$}\;{#2}\;\kw{]}}
\newcommand*{\exInt}[1]{#1}
\newcommand*{\exLambda}[1]{\lambda{#1}}
\newcommand*{\exLet}[3]{\kw{let}\;{#1}={#2}\;\kw{in}\;{#3}}
\newcommand*{\exLetRec}[3]{\kw{let}\,\exRec{#1}{#2}\;\kw{in}\;{#3}}
\newcommand*{\exLetRecMutual}[2]{\kw{let}\,\kw{rec}\;{#1}\;\kw{in}\;{#2}}
\newcommand*{\exIfThenElse}[3]{\kw{if}\;{#1}\;\kw{then}\;{#2}\;\kw{else}\;{#3}}
\newcommand*{\exLetStructured}[2]{\kw{let}\;{#1}\;\kw{in}\;{#2}}
\newcommand*{\exMatch}[2]{\kw{match}~{#1}~\kw{as}\;{#2}}
\newcommand*{\exNil}{\kw{[]}}
\newcommand*{\exOp}[1]{(#1)}
\newcommand*{\exPair}[2]{\langle#1,#2\rangle}
\newcommand*{\exPrim}[1]{#1}
\newcommand*{\exRec}[2]{\kw{rec}\,{#1}{#2}}
\newcommand*{\exTrue}{\kw{true}}
\newcommand*{\exVar}[1]{#1}

% Branches
\newcommand*{\branchCons}[1]{(\symCons)\mapsto{#1}}
\newcommand*{\branchNil}[1]{\exNil\mapsto{#1}}

% List rest
\newcommand*{\sExNil}{\kw{]}}
\newcommand*{\sExCons}[2]{\kw{,} \ #1 \ #2}
\newcommand*{\sExConsAnnot}[3]{\annot{\kw{,}}{#1} \ #2 \ #3}


% Qualifiers
\newcommand*{\qualGuard}[1]{\kw{if}\;{#1}}
\newcommand*{\qualDeclaration}[2]{\kw{let}\;{#1}={#2}}
\newcommand*{\qualGenerator}[2]{{#1}\;\kw{$\leftarrow$}\;{#2}}

% Patterns
\newcommand*{\pattVar}[1]{#1}
\newcommand*{\pattTrue}{\exTrue}
\newcommand*{\pattFalse}{\exFalse}
\newcommand*{\pattCons}[2]{\exCons{#1}{#2}}
\newcommand*{\pattNil}{\exNil}
\newcommand*{\pattList}[2]{\sExList{#1}{#2}}
\newcommand*{\pattSCons}[2]{\sExCons{#1}{#2}}
\newcommand*{\pattSNil}{\sExNil}
\newcommand*{\pattPair}[2]{\langle#1,#2\rangle}

% Eliminators.
\newcommand*{\elimBool}[2]{\{\exTrue \mapsto {#1}, \exFalse \mapsto {#2}\}}
\newcommand*{\elimBoolTrue}[1]{\{\exTrue \mapsto {#1}\}}
\newcommand*{\elimBoolFalse}[1]{\{\exFalse \mapsto {#1}\}}
\newcommand*{\elimListSingleton}[1]{\{{#1}\}}
\newcommand*{\elimFun}[1]{\elimFunNoRHS \mapsto {#1}}
\newcommand*{\elimList}[2]{\{{#1},{#2}\}}
\newcommand*{\elimProd}[1]{{\langle#1\rangle}}
\newcommand*{\elimVar}[2]{{#1} \mapsto {#2}}

\newcommand*{\singleton}[2]{#1[#2]}

\renewcommand*{\lowlight}[1]{\textcolor{gray}{#1}}

% Matches.
\newcommand*{\matchCons}[3]{\elimList{\branchNil{#1}}{\exCons{#2}{#3}}}
\newcommand*{\matchConsNew}[2]{\exCons{#1}{#2}}
\newcommand*{\matchFalse}[1]{\elimBool{#1}{\matchHole}}
\newcommand*{\matchFalseNew}{\exFalse}
\newcommand*{\matchHole}{\square}
\newcommand*{\matchNil}[1]{\elimList{\branchNil{\matchHole}}{\branchCons{#1}}}
\newcommand*{\matchNilNew}{\exNil}
\newcommand*{\matchPairNew}[2]{\exPair{#1}{#2}}
\newcommand*{\matchPlug}[2]{{#1} \mapsto {#2}}
\newcommand*{\matchTrueNew}{\exTrue}
\newcommand*{\matchTrue}[1]{\elimBool{\matchHole}{#1}}
\newcommand*{\matchVar}[1]{\elimVar{#1}{\matchHole}}
\newcommand*{\matchVarNew}[1]{#1}

\newcommand*{\interpret}[1]{\hat{#1}}

% Types.
\newcommand*{\tyBool}[0]{\kw{Bool}}
\newcommand*{\tyInt}[0]{\kw{Int}}
\newcommand*{\tyList}[1]{\kw{List}\;{#1}}
\newcommand*{\tyProd}[2]{{#1}\times{#2}}
\newcommand*{\tyFun}[2]{{#1}\rightarrow{#2}}

% Sets
\newcommand*{\Ann}[1]{\Set{Ann}(#1)}
\newcommand*{\Below}[1]{{\downarrow{#1}}}
\newcommand*{\Cxt}{\Set{Cxt}}
\newcommand*{\Env}[1]{\Set{Env}\,#1}
\newcommand*{\Expl}[1]{\Set{Expl}\,#1}
\newcommand*{\ExplVal}[2]{\ExplValPartial{#1}\:#2}
\newcommand*{\ExplValPartial}[1]{\Set{ExplVal}\,#1}
\newcommand*{\Expr}[2]{\ExprPartial{#1}\,#2}
\newcommand*{\ExprPartial}[1]{\Set{Term}\,#1}
\newcommand*{\Match}[4]{\Set{Match}\,#1\,#2\,#3\,#4}
\newcommand*{\Prim}[3]{\Set{Prim}\,#1\,#2\,#3}
\newcommand*{\BinaryOp}[3]{\Set{BinaryOp}\,#1\,#2\,#3}
\newcommand*{\Trie}[3]{\Set{Trie}\,#1\,#2\,#3}
\newcommand*{\UnaryOp}[2]{\Set{UnaryOp}\,#1\,#2}
\newcommand*{\Val}[1]{\Set{Val}\,#1}
\newcommand*{\ValExpl}[2]{\Set{Val}\,#1\:#2}

% Misc.
\newcommand*{\rcons}{\cdot} % can't use \snoc as a macro name inside mathpar
\newcommand*{\cons}{::}
\newcommand*{\unionWith}[1]{\cup_{#1}}
\renewcommand*{\join}{\vee}
\renewcommand*{\meet}{\wedge}
\newcommand*{\joinWith}[1]{\join_{#1}}
\newcommand*{\eqJoin}{\mathbin{!}}
\newcommand*{\range}[2]{\kw{range} \ {#1}\,{#2}}
\newcommand*{\desugar}[1]{\kw{desugar}\;({#1})}
\newcommand*{\comma}{\kw{,}\;}

% Variable contexts.
\newcommand*{\cxtBot}{\exBot}
\newcommand*{\cxtEmpty}{\varepsilon}
\newcommand*{\cxtExtend}[3]{{#1},{#2}: {#3}}
\newcommand*{\cxtLookup}[2]{{#1}[{x}]}

% Environments.
\newcommand*{\subst}[3]{{#1}[{#2}/{#3}]} % still needed for recursive types..
\newcommand*{\envEmpty}{\varepsilon}
\newcommand*{\envExtend}[3]{{#1}[{#2}: {#3}]}
\newcommand*{\envLookup}[3]{{#2}: {#3} \in {#1}}
\newcommand*{\envUpdate}[3]{{#1}\smalltriangleleft[{#2}: {#3}]}
\newcommand*{\env}[1]{\mathsf{env}(#1)}

% Evaluation.
\newcommand*{\eval}{\mathrel{\Rightarrow}}
% \newcommand*{\fwdSlice}{\nearrow}
% \newcommand*{\bwdSlice}{\searrow}
\newcommand*{\fwdSlice}{\mathrel{\rotatebox[origin=c]{45}{$\eval$}}}
\newcommand*{\bwdSlice}{\mathrel{\rotatebox[origin=c]{-45}{$\eval$}}}
\newcommand*{\match}{\rightsquigarrow}
\newcommand*{\matchFwd}{\mathrel{\rotatebox[origin=c]{45}{$\rightsquigarrow$}}}
\newcommand*{\matchBwd}{\mathrel{\rotatebox[origin=c]{-45}{$\rightsquigarrow$}}}
\newcommand*{\proj}{\downarrow}
\newcommand*{\nproj}{\not\downarrow}
\newcommand*{\val}[1]{\mathsf{val}(#1)}

\newcommand*{\seq}{\mathrel{\smalltriangleright}}

% Traces.
\newcommand*{\trApp}[3]{\exApp{#1}{#2}\seq{#3}}
\newcommand*{\trAppPrim}[2]{\exApp{#1}{#2}}
\newcommand*{\trBinaryApp}[4]{\exBinaryApp{#1}{#2_{#3}}{#4}}
\newcommand*{\trCons}[2]{\exCons{#1}{#2}}
\newcommand*{\trFalse}{\exFalse}
\newcommand*{\trInt}[1]{\exInt{#1}}
\newcommand*{\trLambda}[1]{\exLambda{#1}}
\newcommand*{\trLet}[3]{\exLet{#1}{#2}{#3}}
\newcommand*{\trLetRec}[3]{\exLetRec{#1}{#2}{#3}}
\newcommand*{\trLetRecMutual}[2]{\exLetRecMutual{#1}{#2}}
\newcommand*{\trLetStructured}[2]{\exLetStructured{#1}{#2}}
\newcommand*{\trMatch}[2]{\exMatch{#1}{#2}}
\newcommand*{\trNil}{\exNil}
\newcommand*{\trOp}[1]{\exOp{#1}}
\newcommand*{\trPair}[2]{\exPair{#1}{#2}}
\newcommand*{\trRec}[2]{\kw{rec}\,{#1}{#2}}
\newcommand*{\trTrue}{\exTrue}
\newcommand*{\trVar}[1]{#1}

\newcommand*{\explVal}[2]{{\textcolor{gray}{#1}}\mathrel{::}{#2}}

% Desugaring.
\newcommand*{\tarrow}{\mathrel{\Rightarrow}}
\newcommand*{\darrow}{\mathrel{\twoheadrightarrow}}
\newcommand*{\dfwdarrow}{\mathrel{{\rotatebox[origin=c]{45}{$\twoheadrightarrow$}}}}
\newcommand*{\dbwdarrow}{\mathrel{{\rotatebox[origin=c]{-45}{$\twoheadrightarrow$}}}}
\newcommand*{\matchp}{\overset{p}{\rightsquigarrow}}
\newcommand*{\totalise}[2]{\mathsf{totalise}({#1}, {#2})}
\newcommand*{\totaliseRest}[2]{\mathsf{totaliseRest}({#1}, {#2})}
\newcommand*{\untotalise}[2]{\mathsf{untotalise}({#1}, {#2})}
\newcommand*{\untotaliseRest}[2]{\mathsf{untotaliseRest}({#1}, {#2})}
\newcommand*{\branch}[2]{\kw{branch}({#1}, {#2})}
