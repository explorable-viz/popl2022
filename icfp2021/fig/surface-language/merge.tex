\begin{figure}[H]
\flushleft\shadebox{merge $\vec{c} = \sigma$ }
\begin{salign}
   \merge{\vec{c}} &=
      \kw{fold} \ (\join) \ (\kw{map} \ (\lambda (\clause{p}{s}) \rightarrow \elim{\vec{p}}{s}) \ \vec{c})
\end{salign}
\caption{Merge}
\end{figure}


\begin{figure}[H]
\flushleft\shadebox{unmerge $\sigma \ \vec{c} = \vec{c}'$ }
\begin{salign}
   \unmerge{\sigma}{\vec{c}} &= \zipWith{\mathsf{updateClause}}{\vec{c}}{\vec{\kappa}}\\
   &\where \ \vec{\kappa} = \conts{\sigma}\\
   &\hspace{0.8cm} \mathsf{updateClause} \;\ (\clause{p}{s}) \;\ \kappa \;\ = \;\ (\clause{p}{\kappa})
\end{salign}
\caption{Unmerge - to check}
\end{figure}


\begin{figure}[H]
\flushleft\shadebox{elim $c = \sigma$}
\begin{salign}
   \elim{\clausenv{p \cdot \vec{p}}{\kappa}} &= \elim{\clausenv{p}{\lambda \vec{p} \rightarrow \elim{\clause{p}{\kappa}}}}
   \\
   \\
   \elim{\clausenv{x}{\kappa}} &= \elimVar{x}{\kappa}
   \\
   \elim{\clausenv{\pattNil}{\kappa}} &= \elimList{\branchNil{\kappa}}{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}
   \\
   \elim{\clausenv{\pattCons{p}{p'}}{\kappa}} &= \elimList{\branchNil{\matchHole}}{\branchCons{\elim{\clausenv{p}{\elim{\clausenv{p'}{\kappa}}}}}}
   \\
   \elim{\clausenv{\pattList{p}{o}}{\kappa}} &= \elim{\clausenv{\pattSCons{p}{o}}{\kappa}}
   \\
   \elim{\clausenv{\pattPair{p}{p'}}{\kappa}} &= \elimProd{\elim{\clausenv{p}{\elim{\clausenv{p'}{\kappa}}}}}
   \\
   \\
   \elim{\clausenv{\pattSNil}{\kappa}} &= \elimList{\branchNil{\kappa}}{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}
   \\
   \elim{\clausenv{\pattSCons{p}{o}}{\kappa}} &= \elim{\clausenv{p}{\elim{\clausenv{o}{\kappa}}}}
\end{salign}
\caption{Elim - Create eliminator from pattern and continuation - to check}
\end{figure}


%\begin{figure}[H]
%\flushleft\shadebox{unelim $\sigma \ c = c'$ }
%\begin{salign}
%   \unelim{\elimVar{x}{\kappa}}{\clause{p}{s}}
%   &= \clause{p}{\kappa}
%   \\
%   \unelim{\elimList{\branchNil{\kappa}}{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}}{\clause{p}{s}}
%   &= \clause{p}{\kappa}
%   \\
%   \unelim{\elimList{\branchNil{\matchHole}}{\branchCons{s \mapsto s' \mapsto \kappa}}}{\clause{p}{s^{\twoPrime}}}
%   &= \clause{p}{\kappa}
%   \\
%   \unelim{\elimProd{s \mapsto s' \mapsto \kappa}}{\clause{p}{s^{\twoPrime}}}
%   &= \clause{p}{\kappa}
%\end{salign}
%\caption{Unelim}
%\end{figure}

\begin{figure}[H]
\flushleft\shadebox{conts $\sigma = \vec{\kappa}$}
\begin{salign}
   \conts{\{\elimVar{x}{\kappa}\}}
   &= \kappa
   \\
   \conts{\elimList{\branchCons{\_ \mapsto \_ \mapsto \kappa}}{\branchNil{\kappa'}}}
   &= \conts{\kappa} \cdot \conts{\kappa'}
   \\
   \conts{\elimList{\branchCons{\_ \mapsto \_ \mapsto \kappa}}{\branchNil{\matchHole}}}
   &= \conts{\kappa}
   \\
   \conts{\elimList{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}{\branchNil{\kappa}}}
   &= \conts{\kappa}
   \\
   \conts{\elimProd{\sigma}}
   &= \conts{\sigma}
\end{salign}
\caption{Continuations - extract branch bodies from eliminator}
\end{figure}