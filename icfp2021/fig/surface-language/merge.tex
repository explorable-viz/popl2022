\begin{figure}[H]
\flushleft\shadebox{merge $\vec{c} = \sigma$ }
\begin{salign}
   \merge{\vec{c}} &=
      \kw{fold} \ (\join) \ (\kw{map} \ (\lambda (\clause{p}{s}) \rightarrow \elim{\vec{p}}{s}) \ \vec{c})
\end{salign}
\caption{Merge}
\end{figure}


\begin{figure}[H]
\flushleft\shadebox{unmerge $\sigma \ \vec{c} = \vec{c}'$ }
\begin{salign}
   \unmerge{\sigma}{\vec{c}} &= \zipWith{\kw{updateClause}}{\vec{c}}{\vec{\kappa}}\\
   &\where \ \vec{\kappa} = \conts{\sigma}\\
   &\hspace{0.8cm} \kw{updateClause} \;\ (\clause{p}{s}) \;\ \kappa \;\ = \;\ (\clause{p}{\kappa})
\end{salign}
\caption{Unmerge}
\end{figure}


\begin{figure}[H]
\flushleft\shadebox{elim $p \ \kappa = \sigma$ }
\begin{salign}
   \elim{x}{\kappa} &= \elimVar{x}{\kappa}
   \\
   \elim{\pattNil}{\kappa} &= \elimList{\branchNil{\kappa}}{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}
   \\
   \elim{\pattCons{p}{p'}}{\kappa} &= \elimList{\branchNil{\matchHole}}{\branchCons{\elim{p}{\elim{p'}{\kappa}}}}
   \\
   \elim{\pattList{p}{o}}{\kappa} &= \elim{\pattSCons{p}{o}}{\kappa}
   \\
   \elim{\pattPair{p}{p'}}{\kappa} &= \elimProd{\elim{p}{\elim{p'}{\kappa}}}
\end{salign}

\flushleft\shadebox{elim $o \ \kappa = \sigma$ }
\begin{salign}
   \elim{\pattSNil}{\kappa} &= \elimList{\branchNil{\kappa}}{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}
   \\
   \elim{\pattSCons{p}{o}}{\kappa} &= \elim{p}{\elim{o}{\kappa}}
\end{salign}

\flushleft\shadebox{elim $\vec{p} \ \kappa = \sigma$ }
\begin{salign}
   \elim{p \cdot \vec{p}}{\kappa} &= \elim{p}{\lambda \vec{p} \rightarrow \elim{\vec{p}}{\kappa}}
\end{salign}
\caption{Elim - Create eliminator from pattern and continuation}
\end{figure}


%\begin{figure}[H]
%\flushleft\shadebox{unelim $\sigma \ c = c'$ }
%\begin{salign}
%   \unelim{\elimVar{x}{\kappa}}{\clause{p}{s}}
%   &= \clause{p}{\kappa}
%   \\
%   \unelim{\elimList{\branchNil{\kappa}}{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}}{\clause{p}{s}}
%   &= \clause{p}{\kappa}
%   \\
%   \unelim{\elimList{\branchNil{\matchHole}}{\branchCons{s \mapsto s' \mapsto \kappa}}}{\clause{p}{s^{\twoPrime}}}
%   &= \clause{p}{\kappa}
%   \\
%   \unelim{\elimProd{s \mapsto s' \mapsto \kappa}}{\clause{p}{s^{\twoPrime}}}
%   &= \clause{p}{\kappa}
%\end{salign}
%\caption{Unelim}
%\end{figure}

\begin{figure}[H]
\flushleft\shadebox{conts $\sigma = \vec{\kappa}$}
\begin{salign}
   \conts{\{\elimVar{x}{\kappa}\}}
   &= \kappa
   \\
   \conts{\elimList{\branchCons{\_ \mapsto \_ \mapsto \kappa}}{\branchNil{\kappa'}}}
   &= \conts{\kappa} \cdot \conts{\kappa'}
   \\
   \conts{\elimList{\branchCons{\_ \mapsto \_ \mapsto \kappa}}{\branchNil{\matchHole}}}
   &= \conts{\kappa}
   \\
   \conts{\elimList{\branchCons{\_ \mapsto \_ \mapsto \matchHole}}{\branchNil{\kappa}}}
   &= \conts{\kappa}
   \\
   \conts{\elimProd{\sigma}}
   &= \conts{\sigma}
\end{salign}
\caption{Continuations - extract branch bodies from eliminator}
\end{figure}