\begin{figure}[H]
\flushleft \shadebox{$s \dfwdarrow e$}
\begin{smathpar}
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-$\hole$}}
]
{
   \strut
}
{
   \hole \dfwdarrow \hole
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-apply}}
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
}
{
   \annot{(\exApp{s}{s'})}{\alpha} \dfwdarrow \annot{(\exApp{e}{e'})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-nil}}
]
{
   \strut
}
{
   \annot{\exNil}{\alpha} \dfwdarrow \annot{\exNil}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-non-empty-list}}
]
{
   s \dfwdarrow e
   \\
   l \dfwdarrow e'
}
{
   \annot{(\exList{s}{l})}{\alpha} \dfwdarrow \annot{(\exCons{e}{e'})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-cons}}
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
}
{
   \annot{(\exCons{s}{s'})}{\alpha} \dfwdarrow \annot{(\exCons{e}{e'})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-let-rec}}
]
{
   \vec{c} \dfwdarrow \sigma
   \\
   s \dfwdarrow e
}
{
   \annot{(\exLetRecEquational{f}{\vec{c}}{s})}{\alpha} \dfwdarrow \annot{(\exLetRec{f}{\sigma}{e})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-match}}
]
{
   s \dfwdarrow e
   \\
   \vec{c} \dfwdarrow \sigma
}
{
   \annot{(\exMatch{s}{\vec{c}})}{\alpha}
   \dfwdarrow
   \annot{(\exApp{\annot{(\exLambda{\sigma})}{\alpha}}{e})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-let}}
]
{
   s \dfwdarrow e
   \\
   \clauseUncurried{p}{s'} \dfwdarrow \sigma
}
{
   \annot{(\exLet{p}{s}{s'})}{\alpha}
   \dfwdarrow
   \annot{(\exApp{\annot{(\exLambda{\sigma})}{\alpha}}{e})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-if}}
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
   \\
   s^{\twoPrime} \dfwdarrow e^{\twoPrime}
}
{
   \annot{(\exIfThenElse{s}{s'}{s^{\twoPrime}})}{\alpha}
   \dfwdarrow
   \annot{(\exApp{\annot{\exLambda{\elimBool{e'}{e^{\twoPrime}}}}{\alpha}}{e})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-enum}},
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
}
{
   \annot{\exListSeq{s}{s'}}{\alpha}
   \dfwdarrow
   \annot{(\exApp{\annot{(\exApp{\annot{\kw{enumFromTo}}{\alpha}}{e})}{\alpha}}{e'})}{\alpha}
}
%
\and
%
\inferrule*[lab={\ruleName{$\dfwdarrow$-list-comp-done}}]
{
   s \dfwdarrow e
}
{
   \annot{\exListComp{s}{\annot{(\qualGuard{\annot{\exTrue}{\alpha_1}})}{\alpha_2}}}{\alpha_3}
   \dfwdarrow
   \annot{(\exCons{e}{\annot{\exNil}{{\meet}\alpha}})}{{\meet}\alpha}
}
\and
%
\inferrule*[lab={\ruleName{$\dfwdarrow$-list-comp-last}},
   right={$q \neq \exTrue$}
]
{
  \annot{\exListComp{s}{q \concat \annot{(\qualGuard{\annot{\exTrue}{\alpha}})}{\alpha}}}
        {\alpha} \dfwdarrow e
}
{
  \annot{\exListComp{s}{q}}{\alpha} \dfwdarrow e
}
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-comp-guard}}
]
{
   \annot{\exListComp{s}{\vec{q}}}{\alpha_2}
   \dfwdarrow e
   \\
   s' \dfwdarrow e'
}
{
   \annot{\exListComp{s}{\annot{(\qualGuard{s'})}{\alpha_1} \cdot \vec{q}}}{\alpha_2}
   \dfwdarrow
   \annot{(\exApp{\annot{\smash{\exLambda{\elimBool{e}{\annot{\exNil}{{\meet}\alpha}}}}}{{\meet}\alpha}}{e'})}{{\meet}\alpha}
}
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-comp-decl}}
]
{
   \clauseUncurried{p}{\annot{\exListComp{s}{\vec{q}}}{\alpha_2}} \dfwdarrow \sigma
   \\
   s' \dfwdarrow e
}
{
   \annot{\exListComp{s}{\annot{(\qualDeclaration{p}{s'})}{\alpha_1} \cdot \vec{q}}}{\alpha_2}
   \dfwdarrow
   \annot{(\exApp{\annot{(\exLambda{\sigma})}{{\meet}\alpha}}{e})}{{\meet}\alpha}
}
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-comp-gen}}
]
{
   \annot{\clauseUncurried{p}{\exListComp{s}{\vec{q}}}}{\alpha_2} \dfwdarrow \sigma
   \\
   \totalise{\sigma}{\sigma'}
   \\
   s' \dfwdarrow e
}
{
   \annot{\exListComp{s}{\annot{(\qualGenerator{p}{s'})}{\alpha_1} \cdot \vec{q}}}{\alpha_2}
   \dfwdarrow
   \annot{(\exApp{\annot{(\exApp{\annot{\kw{concatMap}}{{\meet}\alpha}}
                                {\annot{(\exLambda{\sigma'})}{{\meet}\alpha}})}
                        {{\meet}\alpha}}{e})}
         {{\meet}\alpha}
}
\end{smathpar}

\vspace{5pt}
\flushleft \shadebox{$l \dfwdarrow e$}
\begin{smathpar}
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-rest-$\hole$}}
]
{
   \strut
}
{
   \hole \dfwdarrow \hole
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-rest-end}}
]
{
   \strut
}
{
   \annot{\sExNil}{\alpha} \dfwdarrow \annot{\exNil}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-rest-cons}}
]
{
   s \dfwdarrow e
   \\
   l \dfwdarrow e'
}
{
   \annot{(\sExCons{s}{l})}{\alpha} \dfwdarrow \annot{{(\exCons{e}{e'})}}{\alpha}
}
\end{smathpar}
\caption{Desugaring -- forward slicing (selected rules)}
\end{figure}
