\begin{figure}[H]
\flushleft \shadebox{$s \dfwdarrow e$}
\begin{smathpar}
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-application}}
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
}
{
   \annot{(s \ s')}{\alpha} \dfwdarrow \annot{(e \ e')}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-empty-list}}
]
{
   \strut
}
{
   \annot{\exNil}{\alpha} \dfwdarrow \annot{\exNil}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-non-empty-list}}
]
{
   s \dfwdarrow e
   \\
   l \dfwdarrow e'
}
{
   \annot{(\exList{s}{l} \ )}{\alpha} \dfwdarrow \annot{(\exCons{e}{e'})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-cons}}
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
}
{
   \annot{(\exCons{s}{s'})}{\alpha} \dfwdarrow \annot{(\exCons{e}{e'})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-recursive-function}}
]
{
   \vec{c} \dfwdarrow \sigma
   \\
   s \dfwdarrow e
}
{
   \annot{(\exLetRecEquational{f}{\vec{c}}{s})}{\alpha} \dfwdarrow \annot{(\exLetRec{f}{\sigma}{e})}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-match-as}}
]
{
   s \dfwdarrow e
   \\
   \vec{c} \dfwdarrow \sigma
}
{
   \annot{(\exMatch{s}{\vec{c}})}{\alpha}
   \dfwdarrow
   \annot{(\annot{(\lambda \sigma)}{\alpha} \ e)}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-let}}
]
{
   s \dfwdarrow e
   \\
   \clauseUncurried{p}{s'} \dfwdarrow \sigma
}
{
   \annot{(\exLet{p}{s}{s'})}{\alpha}
   \dfwdarrow
   \annot{(\annot{(\lambda \sigma)}{\alpha} \ e)}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-if-then-else}}
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
   \\
   s^{\twoPrime} \dfwdarrow e^{\twoPrime}
   \\
   \sigma = \elimBool{e'}{e^{\twoPrime}}
}
{
   \annot{(\exIfThenElse{s}{s'}{s^{\twoPrime}})}{\alpha}
   \dfwdarrow
   \annot{(\annot{(\exLambda{\sigma})}{\alpha} \ e)}{\alpha}
}
%
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-list-enum}},
]
{
   s \dfwdarrow e
   \\
   s' \dfwdarrow e'
}
{
   \annot{\exListSeq{s}{s'}}{\alpha} \dfwdarrow \annot{(\annot{(\kw{enumFromTo} \ e)}{\alpha}{e'})}{\alpha}
}
%
\and
%
\inferrule*[lab={\ruleName{$\dfwdarrow$-list-comp-done}}]
{
   s \dfwdarrow e
}
{
   \annot{\exListComp{s}{\annot{\exTrue}{\alpha_1}}}{\alpha_2}
   \dfwdarrow
   \annot{(\exCons{e}{\annot{\exNil}{\alpha_1 \meet \alpha_2}})}{\alpha_1 \meet \alpha_2}
}
\and
%
\inferrule*[lab={\ruleName{$\dfwdarrow$-list-comp-qual}},
   right={$q \neq \kw{true}$}
]
{
  \annot{\exListComp{s}{q \comma \annot{\exTrue}{\alpha}}}{\alpha} \dfwdarrow e
}
{
  \annot{\exListComp{s}{q}}{\alpha} \dfwdarrow e
}
\and
%
\inferrule*[lab={\ruleName{$\dfwdarrow$-list-comp-guard}},
            right={ \ $\vec{q} \; \textnormal{non-empty}$}]
{
   \annot{\exListComp{s}{\vec{q}}}{\alpha_2}
   \dfwdarrow e
   \\
   \sigma = \elimBool{e}{\exNil}
   \\
   s' \dfwdarrow e'
}
{
   \annot{\exListComp{s}{\annot{(\qualGuard{s'})}{\alpha_1} \cdot \vec{q}}}{\alpha_2}
   \dfwdarrow
   \annot{(\annot{(\exLambda{\sigma})}{\alpha_1 \meet \alpha_2} \ e')}{\alpha_1 \meet \alpha_2}
}
\and
%
\inferrule*[lab={\ruleName{$\dfwdarrow$-list-comp-decl}},
            right={ \ $\vec{q} \; \textnormal{non-empty}$}]
{
   \clauseUncurried{p}{\annot{\exListComp{s}{\vec{q}}}{\alpha_2}} \dfwdarrow \sigma
   \\
   s' \dfwdarrow e
}
{
   \annot{\exListComp{s}{\annot{(\qualDeclaration{p}{s'})}{\alpha_1} \cdot \vec{q}}}{\alpha_2}
   \dfwdarrow
   \annot{(\annot{\exLambda{\sigma}}{\alpha_1 \meet \alpha_2} \ e)}{\alpha_1 \meet \alpha_2}
}
\and
%
\inferrule*[lab={\ruleName{$\dfwdarrow$-list-comp-gen}},
            right={ \ $\vec{q} \; \textnormal{non-empty}$}]
{
   \annot{\clauseUncurried{p}{\exListComp{s}{\vec{q}}}}{\alpha_2} \dfwdarrow \sigma
   \\
   \sigma' = \totalise{\sigma}
   \\
   s' \dfwdarrow e
}
{
   \annot{\exListComp{s}{\annot{(\qualGenerator{p}{s'})}{\alpha_1} \cdot \vec{q}}}{\alpha_2}
   \dfwdarrow
   \annot{(\annot{(\kw{concatMap} \ \annot{\exLambda{\sigma'}}{\alpha_1 \meet \alpha_2})}{\alpha_1 \meet \alpha_2} \ e)}{\alpha_1 \meet \alpha_2}
}
\end{smathpar}
\caption{Desugaring -- forward slicing (selected rules only)}
\end{figure}

\begin{figure}[H]
\flushleft \shadebox{$l \dfwdarrow e$}
\begin{smathpar}
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-end}}
]
{
   \strut
}
{
   \annot{\sExNil}{\alpha} \dfwdarrow \annot{\exNil}{\alpha}
}
\and
%
\inferrule*[
   lab={\ruleName{$\dfwdarrow$-cons}}
]
{
   s \dfwdarrow e
   \\
   l \dfwdarrow e'
}
{
   \annot{(\sExCons{s}{l})}{\alpha} \dfwdarrow \annot{{(\exCons{e}{e'})}}{\alpha}
}
\end{smathpar}
\caption{Desugaring list rest -- forward slicing}
\end{figure}
