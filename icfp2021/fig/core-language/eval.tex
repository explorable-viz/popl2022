\begin{figure}[H]
\flushleft \shadebox{$\explVal{T}{\rho, e \eval v}$}
\begin{smathpar}
   \inferrule*[
      lab={\ruleName{$\eval$-var}},
      right={\textnormal{$x: v \in \rho$}}
   ]
   {
      \strut
   }
   {
      \explVal{x}{\rho, x \eval v}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-op}},
      right={$\primOp: \phi \in \rho$}
   ]
   {
      \strut
   }
   {
      \explVal{\trOp{\primOp}}{\rho, \exOp{\primOp} \eval \phi}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-true}}]
   {
      \strut
   }
   {
      \explVal{\trTrue}{\rho, \exTrue \eval \exTrue}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-false}}]
   {
      \strut
   }
   {
      \explVal{\trFalse}{\rho, \exFalse \eval \exFalse}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-int}}]
   {
      \strut
   }
   {
      \explVal{\trInt{n}}{\rho, \exInt{n} \eval \exInt{n}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-pair}}]
   {
      \explVal{T}{\rho, e \eval v}
      \\
      \explVal{U}{\rho, e' \eval v'}
   }
   {
      \explVal{\trPair{T}{U}}{\rho, \exPair{e}{e'} \eval \exPair{v}{v'}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-nil}}]
   {
      \strut
   }
   {
      \explVal{\trNil}{\rho, \exNil \eval \exNil}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-cons}}]
   {
      \explVal{T}{\rho, e \eval v}
      \\
      \explVal{U}{\rho, e' \eval v'}
   }
   {
      \explVal{\trCons{T}{U}}{\rho, \exCons{e}{e'} \eval \exCons{v}{v'}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-matrix}}]
   {
      \explVal{T}{\rho, e' \eval \exPair{i'}{j'}}
      \\
      \forall (i,j) \leq (i',j').\explVal{U_{i,j}}{\envExtend{\envExtend{\rho}{x}{i}}{y}{j}, e \eval v_{i,j}}
   }
   {
      \explVal{\trMatrixNew{U_{i,j}}{x}{y}{i}{j}{T}{i',j'}}
              {\rho, \exMatrix{e'}{x}{y}{e} \eval \exMatrix{\exPair{i'}{j'}}{i}{j}{v_{i,j}}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-matrix-lookup}},
      right={$(i,j) \leq (i',j')$}
   ]
   {
      \explVal{T}{\rho, e \eval \exMatrix{\exPair{i'}{j'}}{i}{j}{v_{i,j}}}
      \\
      \explVal{U}{\rho, e' \eval \exPair{i}{j}}
   }
   {
      \explVal{\trMatrixAccessNew{T}{i',j'}{U}{i,j}}{\rho, \exMatrixAccess{e}{e'} \eval v_{i,j}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-matrix-dims}}]
   {
      \explVal{T}{\rho, e \eval \exMatrix{\exPair{i'}{j'}}{i}{j}{v_{i,j}}}
   }
   {
      \explVal{\trMatrixDimsNew{T}{i',j'}}{\rho, \exMatrixDims{e} \eval \exPair{i'}{j'}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-apply}}]
   {
      \explVal{T}{\rho, e \eval \exClosureRec{\rho'}{f}{\sigma}}
      \\
      \explVal{U}{\rho, e' \eval v}
      \\
      \explVal{w}{v, \sigma \match \rho^\twoPrime, e^\twoPrime}
      \\
      \explVal{T'}{\envExtend{(\rho' \concat \rho^\twoPrime)}{f}{\exClosureRec{\rho'}{f}{\sigma}}, e^\twoPrime \eval v'}
   }
   {
      \explVal{\trApp{T}{U}{\matchPlug{w}{T'}}}{\rho, \exApp{e}{e'} \eval v'}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-apply-prim}}]
   {
      \explVal{T}{\rho, e \eval \phi}
      \\
      \explVal{U}{\rho, e' \eval \exInt{n}}
   }
   {
      \explVal{\trAppPrimNew{T}{\phi}{U}{n}}{\rho, \exApp{e}{e'} \eval \phi(n)}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-binary-apply}},
      right={$\primOp: \phi \in \rho$}
   ]
   {
      \explVal{T}{\rho, e \eval n}
      \\
      \explVal{U}{\rho, e' \eval m}
   }
   {
      \explVal{\trBinaryAppNew{T}{n}{\primOp}{\phi}{U}{m}}{\rho, \exBinaryApp{e}{\primOp}{e'} \eval \phi(n)(m)}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-let}}]
   {
      \explVal{T}{\rho, e \eval v}
      \\
      \explVal{U}{\envExtend{\rho}{x}{v}, e' \eval v'}
   }
   {
      \explVal{\trLet{x}{T}{U}}{\rho, \exLet{x}{e}{e'} \eval v'}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-let-rec}}]
   {
      \explVal{T}{\envExtend{\rho}{f}{\exClosureRec{\rho}{f}{\sigma}}, e \eval v}
   }
   {
      \explVal{\trLetRec{f}{\sigma}{T}}{\rho, \exLetRec{f}{\sigma}{e} \eval v}
   }
\end{smathpar}
\caption{Evaluation}
\end{figure}
