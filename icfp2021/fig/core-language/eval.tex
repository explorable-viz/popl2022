\begin{figure}[H]
\flushleft \shadebox{$\explVal{T}{\rho, e \eval v}$}
\begin{smathpar}
   \inferrule*[
      lab={\ruleName{$\eval$-var}},
      right={$\vdash \rho: \Gamma$}
   ]
   {
      \envLookup{\rho}{x}{v}
   }
   {
      \explVal{\trVar{x}{\Gamma}}{\rho, x \eval v}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-op}},
      right={$\vdash \rho: \Gamma$}
   ]
   {
      \envLookup{\rho}{\primOp}{\phi}
   }
   {
      \explVal{\trOp{\primOp}{\Gamma}}{\rho, \exOp{\primOp} \eval \phi}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-lambda}}]
   {
      \strut
   }
   {
      \explVal
         {\trLambda{\sigma}}
         {\rho, \exLambda{\sigma} \eval \exClosure{\rho}{\seqEmpty}{\sigma}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-true}},
      right={$\vdash \rho: \Gamma$}
   ]
   {
      \strut
   }
   {
      \explVal{\trTrue{\Gamma}}{\rho, \exTrue \eval \exTrue}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-false}},
      right={$\vdash \rho: \Gamma$}
   ]
   {
      \strut
   }
   {
      \explVal{\trFalse{\Gamma}}{\rho, \exFalse \eval \exFalse}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-int}},
      right={$\vdash \rho: \Gamma$}
   ]
   {
      \strut
   }
   {
      \explVal{\trInt{n}{\Gamma}}{\rho, \exInt{n} \eval \exInt{n}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-pair}}]
   {
      \explVal{T}{\rho, e \eval v}
      \\
      \explVal{U}{\rho, e' \eval v'}
   }
   {
      \explVal{\trPair{T}{U}}{\rho, \exPair{e}{e'} \eval \exPair{v}{v'}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-nil}},
      right={$\vdash \rho: \Gamma$}
   ]
   {
      \strut
   }
   {
      \explVal{\trNil{\Gamma}}{\rho, \exNil \eval \exNil}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-cons}}]
   {
      \explVal{T}{\rho, e \eval v}
      \\
      \explVal{U}{\rho, e' \eval v'}
   }
   {
      \explVal{\trCons{T}{U}}{\rho, \exCons{e}{e'} \eval \exCons{v}{v'}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-matrix}}]
   {
      \explVal{T}{\rho, e' \eval \exPair{\ihat}{\jhat}}
      \\
      \explVal{U_{i,j}}{\rho \concat \bind{x}{i} \concat \bind{y}{j}, e \eval v_{i,j}}
      \quad
      (\forall (i,j) \leq (\ihat,\jhat))
   }
   {
      \explVal{\trMatrix{U_{i,j}}{x}{y}{i}{j}{T}{\ihat,\jhat}}
              {\rho, \exMatrix{e}{x}{y}{e'} \eval \exMatrix{v_{i,j}}{i}{j}{\exPair{\ihat}{\jhat}}}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-matrix-lookup}},
      right={$(i,j) \leq (\ihat,\jhat)$}
   ]
   {
      \explVal{T}{\rho, e \eval \exMatrix{v_{i,j}}{i}{j}{\exPair{\ihat}{\jhat}}}
      \\
      \explVal{U}{\rho, e' \eval \exPair{i}{j}}
   }
   {
      \explVal{\trMatrixAccess{T}{\ihat,\jhat}{U}{i,j}}{\rho, \exMatrixAccess{e}{e'} \eval v_{i,j}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-matrix-dims}}]
   {
      \explVal{T}{\rho, e \eval \exMatrix{v_{i,j}}{i}{j}{\exPair{\ihat}{\jhat}}}
   }
   {
      \explVal{\trMatrixDims{T}{\ihat,\jhat}}{\rho, \exMatrixDims{e} \eval \exPair{\ihat}{\jhat}}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-apply}}]
   {
      \explVal{T}{\rho, e \eval \exClosureRec{\Gamma}{\rho_1}{h}{\sigma}}
      \\
      \rho_1, h \closeDefs \rho_2
      \\
      \explVal{U}{\rho, e' \eval v}
      \\
      \explVal{w}{v, \sigma \match \rho_3, e_1}
      \\
      \explVal{T'}{\rho_1 \concat \rho_2 \concat \rho_3, e_1 \eval v'}
   }
   {
      \explVal{\trApp{T}{U}{\matchPlug{w}{T'}}}{\rho, \exApp{e}{e'} \eval v'}
   }
   %
   \and
   %
   \inferrule*[lab={\ruleName{$\eval$-apply-prim}}]
   {
      \explVal{T}{\rho, e \eval \phi}
      \\
      \explVal{U}{\rho, e' \eval \exInt{n}}
   }
   {
      \explVal{\trAppPrim{T}{\phi}{U}{n}}{\rho, \exApp{e}{e'} \eval \phi(n)}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-binary-apply}}
   ]
   {
      \explVal{T}{\rho, e \eval n}
      \\
      \explVal{U}{\rho, e' \eval m}
      \\
      \primOp: \phi \in \rho
   }
   {
      \explVal{\trBinaryApp{T}{n}{\primOp}{\phi}{U}{m}}{\rho, \exBinaryApp{e}{\primOp}{e'} \eval \phi(n)(m)}
   }
%   %
%   \and
%   %
%   \inferrule*[lab={\ruleName{$\eval$-let}}]
%   {
%      \explVal{T}{\rho, e \eval v}
%      \\
%      \explVal{U}{\envExtend{\rho}{x}{v}, e' \eval v'}
%   }
%   {
%      \explVal{\trLet{x}{T}{U}}{\rho, \exLet{x}{e}{e'} \eval v'}
%   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\eval$-let-rec}}
   ]
   {
      \rho, h \closeDefs \rho'
      \\
      \explVal{T}{\rho \concat \rho', e \eval v}
   }
   {
      \explVal{\trLetRecMutual{h}{T}}{\rho, \exLetRecMutual{h}{e} \eval v}
   }
\end{smathpar}

\vspace{5pt}
\flushleft\shadebox{$\rho, h \closeDefs \rho'$}
\begin{salign}
   \rho, h
   &\closeDefs
   \seqRange{\bind{x_1}{\exClosure{\rho}{h}{\sigma_1}}}{\bind{x_n}{\exClosure{\rho}{h}{\sigma_n}}}
   \\
   & \text{where $h = \seqRange{\bind{x_1}{\sigma_1}}{\bind{x_n}{\sigma_n}}$}
\end{salign}
\caption{Evaluation}
\end{figure}
