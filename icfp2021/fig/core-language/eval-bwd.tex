\begin{figure}[H]
\flushleft \shadebox{$\evalBwd{v}{T}{\rho}{e}{\alpha}$}
\begin{smathpar}
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-var}}
   ]
   {
      \envLookupBwd{\rho}{\Gamma}{\bind{x}{v}}
   }
   {
      \evalBwd{v}{\trVar{x}{\Gamma}}{\rho}{\exVar{x}}{\FF}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-op}}
   ]
   {
      v \geq \phi
      \\
      \envLookupBwd{\rho}{\Gamma}{\bind{\primOp}{\phi}}
   }
   {
      \evalBwd{v}{\trOp{\primOp}{\Gamma}}{\rho}{\exOp{\primOp}}{\FF}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-lambda}}
   ]
   {
      v \geq \exClosure{\rho}{\seqEmpty}{\sigma}
   }
   {
      \evalBwd{v}{\trLambda{\sigma'}}{\rho}{\exLambda{\sigma}}{\FF}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-int}}
   ]
   {
      v \geq \annInt{n}{\alpha}
   }
   {
      \evalBwd{v}{\trInt{n}{\Gamma}}{\hole_{\Gamma}}{\annInt{n}{\alpha}}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-nil}}
   ]
   {
      v \geq \annNil{\alpha}
   }
   {
      \evalBwd{v}{\trNil{\Gamma}}{\hole_{\Gamma}}{\annNil{\alpha}}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-cons}}
   ]
   {
      v \geq \annCons{v_1}{v_2}{\beta}
      \\
      \evalBwd{v_1}{T}{\rho}{e_1}{\alpha}
      \\
      \evalBwd{v_2}{U}{\rho'}{e_2}{\alpha'}
   }
   {
      \evalBwd{v}
              {\trCons{T}{U}}
              {\rho \join \rho'}
              {\annCons{e_1}{e_2}{\beta}}
              {\beta \join \alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-matrix}}
   ]
   {
      v \geq \annMatrix{u_{i,j}}{i}{j}{(\annInt{\ihat}{\beta},\annInt{\jhat}{\beta'})}{\alpha}
      \\
      \evalBwd{u_{i,j}}
              {U_{i,j}}
              {\rho_{i,j} \concat \bind{x}{i_{\gamma_{i,j}}} \concat \bind{y}{j_{\gamma'_{i,j}}}}
              {e_{i,j}}
              {\alpha'_{i,j}}
      \quad
      (\forall (i,j) \numleq (\ihat,\jhat))
      \\
      \evalBwd{\annot{\exPair{\annInt{\ihat}{\bigjoin\gamma \join \beta}}
                     {\annInt{\jhat}{\bigjoin\gamma' \join \beta'}}}{\FF}}
              {T}
              {\rho'}
              {e'}
              {\alpha''}
   }
   {
      \evalBwd{v}
              {\trMatrix{U_{i,j}}{x}{y}{i}{j}{T}{\ihat,\jhat}}
              {(\bigjoin\rho) \join \rho'}
              {\annMatrix{\bigjoin e}{x}{y}{e'}{\alpha}}
              {\alpha \join (\bigjoin{\alpha'}) \join \alpha''}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-matrix-lookup}}
   ]
   {
      \evalBwd{\mapUpdate{\annMatrix{\hole}{i}{j}{(\annInt{\ihat}{\FF},\annInt{\jhat}{\FF})}{\FF}}{\exPair{i}{j}}{v}}
              {T}{\rho}{e}{\alpha}
      \\
      \evalBwd{\annPair{\annInt{i}{\FF}}{\annInt{j}{\FF}}{\FF}}{U}{\rho'}{e'}{\alpha'}
   }
   {
      \evalBwd{v}{\trMatrixAccess{T}{\ihat,\jhat}{U}{i,j}}{\rho \join \rho'}{\exMatrixAccess{e}{e'}}{\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-matrix-dims}}
   ]
   {
      v \geq \annPair{\annInt{\ihat}{\beta}}{\annInt{\jhat}{\beta'}}{\gamma}
      \\
      \evalBwd{\annMatrix{\hole}{i}{j}{(\annInt{\ihat}{\beta},\annInt{\jhat}{\beta'})}{\gamma}}{T}{\rho}{e}{\alpha}
   }
   {
      \evalBwd{v}{\trMatrixDims{T}{\ihat,\jhat}}{\rho}{\exMatrixDims{e}}{\alpha}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-apply}}
   ]
   {
      \evalBwd{v}{T'}{\rho_1 \concat \rho_2 \concat \rho_3}{e}{\beta}
      \\
      \rho_3, e, \beta, w, \matchBwd v', \sigma
      \\
      \evalBwd{v'}{U}{\rho}{e_2}{\alpha}
      \\
      \rho_2 \closeDefsBwd \rho_1', h
      \\
      \evalBwd{\exClosureRec{\Gamma}{\rho_1 \join \rho_1'}{h}{\sigma}}{T}{\rho'}{e_1}{\alpha'}
   }
   {
      \evalBwd{v}{\trApp{T}{U}{\matchPlug{w}{T'}}}{\rho \join \rho'}{\exApp{e_1}{e_2}}{\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-apply-prim}}
   ]
   {
      v \geq \annInt{n}{\beta}
      \\
      \evalBwd{\phi}{T}{\rho}{e_1}{\alpha}
      \\
      \evalBwd{\annInt{m}{\beta}}{U}{\rho'}{e_2}{\alpha'}
   }
   {
      \evalBwd{v}{\trAppPrim{T}{\phi}{U}{\exInt{m}}}{\rho \join \rho'}{\exApp{e_1}{e_2}}{\alpha \join \alpha'}
   }
   %
   \and
   %
   \inferrule*[
      lab={\ruleName{$\evalBwdS$-let-rec}}
   ]
   {
      \evalBwd{v}{T}{\rho \concat \rho_1}{e}{\alpha}
      \\
      \rho_1 \closeDefsBwd \rho', h'
   }
   {
      \evalBwd{v}{\trLetRecMutual{h}{T}}{\rho \join \rho'}{\exLetRecMutual{h'}{e}}{\alpha}
   }
\end{smathpar}

\vspace{5pt}
\flushleft\shadebox{$\rho \closeDefsBwd \rho', h$}
\begin{salign}
   \seqRange{x_1: \exClosure{\rho_1}{h_1}{\sigma_1}}{x_n: \exClosure{\rho_n}{h_n}{\sigma_n}}
   &\closeDefsFwd
   \bigjoin\rho,
   (\seqRange{x_1: \sigma_1}{x_n: \sigma_n}) \join (\bigjoin h)
\end{salign}
\caption{Evaluation: backward slicing (Boolean and pair cases omitted)}
\end{figure}
